<!DOCTYPE html>
<html xmlns="http://www.w3.org/1999/xhtml" lang="en" xml:lang="en"><head>

<meta charset="utf-8">
<meta name="generator" content="quarto-1.4.506">

<meta name="viewport" content="width=device-width, initial-scale=1.0, user-scalable=yes">


<title>Sheena Taylor - Project 2: Patent Analysis</title>
<style>
code{white-space: pre-wrap;}
span.smallcaps{font-variant: small-caps;}
div.columns{display: flex; gap: min(4vw, 1.5em);}
div.column{flex: auto; overflow-x: auto;}
div.hanging-indent{margin-left: 1.5em; text-indent: -1.5em;}
ul.task-list{list-style: none;}
ul.task-list li input[type="checkbox"] {
  width: 0.8em;
  margin: 0 0.8em 0.2em -1em; /* quarto-specific, see https://github.com/quarto-dev/quarto-cli/issues/4556 */ 
  vertical-align: middle;
}
/* CSS for syntax highlighting */
pre > code.sourceCode { white-space: pre; position: relative; }
pre > code.sourceCode > span { line-height: 1.25; }
pre > code.sourceCode > span:empty { height: 1.2em; }
.sourceCode { overflow: visible; }
code.sourceCode > span { color: inherit; text-decoration: inherit; }
div.sourceCode { margin: 1em 0; }
pre.sourceCode { margin: 0; }
@media screen {
div.sourceCode { overflow: auto; }
}
@media print {
pre > code.sourceCode { white-space: pre-wrap; }
pre > code.sourceCode > span { text-indent: -5em; padding-left: 5em; }
}
pre.numberSource code
  { counter-reset: source-line 0; }
pre.numberSource code > span
  { position: relative; left: -4em; counter-increment: source-line; }
pre.numberSource code > span > a:first-child::before
  { content: counter(source-line);
    position: relative; left: -1em; text-align: right; vertical-align: baseline;
    border: none; display: inline-block;
    -webkit-touch-callout: none; -webkit-user-select: none;
    -khtml-user-select: none; -moz-user-select: none;
    -ms-user-select: none; user-select: none;
    padding: 0 4px; width: 4em;
  }
pre.numberSource { margin-left: 3em;  padding-left: 4px; }
div.sourceCode
  {   }
@media screen {
pre > code.sourceCode > span > a:first-child::before { text-decoration: underline; }
}
</style>


<script src="../../site_libs/quarto-nav/quarto-nav.js"></script>
<script src="../../site_libs/quarto-nav/headroom.min.js"></script>
<script src="../../site_libs/clipboard/clipboard.min.js"></script>
<script src="../../site_libs/quarto-search/autocomplete.umd.js"></script>
<script src="../../site_libs/quarto-search/fuse.min.js"></script>
<script src="../../site_libs/quarto-search/quarto-search.js"></script>
<meta name="quarto:offset" content="../../">
<script src="../../site_libs/quarto-html/quarto.js"></script>
<script src="../../site_libs/quarto-html/popper.min.js"></script>
<script src="../../site_libs/quarto-html/tippy.umd.min.js"></script>
<script src="../../site_libs/quarto-html/anchor.min.js"></script>
<link href="../../site_libs/quarto-html/tippy.css" rel="stylesheet">
<link href="../../site_libs/quarto-html/quarto-syntax-highlighting.css" rel="stylesheet" id="quarto-text-highlighting-styles">
<script src="../../site_libs/bootstrap/bootstrap.min.js"></script>
<link href="../../site_libs/bootstrap/bootstrap-icons.css" rel="stylesheet">
<link href="../../site_libs/bootstrap/bootstrap.min.css" rel="stylesheet" id="quarto-bootstrap" data-mode="light">
<script id="quarto-search-options" type="application/json">{
  "location": "navbar",
  "copy-button": false,
  "collapse-after": 3,
  "panel-placement": "end",
  "type": "overlay",
  "limit": 50,
  "keyboard-shortcut": [
    "f",
    "/",
    "s"
  ],
  "show-item-context": false,
  "language": {
    "search-no-results-text": "No results",
    "search-matching-documents-text": "matching documents",
    "search-copy-link-title": "Copy link to search",
    "search-hide-matches-text": "Hide additional matches",
    "search-more-match-text": "more match in this document",
    "search-more-matches-text": "more matches in this document",
    "search-clear-button-title": "Clear",
    "search-detached-cancel-button-title": "Cancel",
    "search-submit-button-title": "Submit",
    "search-label": "Search"
  }
}</script>

  <script src="https://polyfill.io/v3/polyfill.min.js?features=es6"></script>
  <script src="https://cdn.jsdelivr.net/npm/mathjax@3/es5/tex-chtml-full.js" type="text/javascript"></script>

<link rel="stylesheet" href="../../styles.css">
</head>

<body class="nav-fixed">

<div id="quarto-search-results"></div>
  <header id="quarto-header" class="headroom fixed-top">
    <nav class="navbar navbar-expand-lg " data-bs-theme="dark">
      <div class="navbar-container container-fluid">
      <div class="navbar-brand-container mx-auto">
    <a class="navbar-brand" href="../../index.html">
    <span class="navbar-title">Sheena Taylor</span>
    </a>
  </div>
            <div id="quarto-search" class="" title="Search"></div>
          <button class="navbar-toggler" type="button" data-bs-toggle="collapse" data-bs-target="#navbarCollapse" aria-controls="navbarCollapse" aria-expanded="false" aria-label="Toggle navigation" onclick="if (window.quartoToggleHeadroom) { window.quartoToggleHeadroom(); }">
  <span class="navbar-toggler-icon"></span>
</button>
          <div class="collapse navbar-collapse" id="navbarCollapse">
            <ul class="navbar-nav navbar-nav-scroll me-auto">
  <li class="nav-item">
    <a class="nav-link" href="../../about.html"> 
<span class="menu-text">About</span></a>
  </li>  
  <li class="nav-item">
    <a class="nav-link" href="../../resume.html"> 
<span class="menu-text">Resume</span></a>
  </li>  
  <li class="nav-item">
    <a class="nav-link" href="../../projects.html"> 
<span class="menu-text">Projects</span></a>
  </li>  
</ul>
          </div> <!-- /navcollapse -->
          <div class="quarto-navbar-tools">
</div>
      </div> <!-- /container-fluid -->
    </nav>
</header>
<!-- content -->
<div id="quarto-content" class="quarto-container page-columns page-rows-contents page-layout-article page-navbar">
<!-- sidebar -->
<!-- margin-sidebar -->
    <div id="quarto-margin-sidebar" class="sidebar margin-sidebar">
        
    </div>
<!-- main -->
<main class="content" id="quarto-document-content">

<header id="title-block-header" class="quarto-title-block default">
<div class="quarto-title">
<h1 class="title">Project 2: Patent Analysis</h1>
</div>



<div class="quarto-title-meta">

    
  
    
  </div>
  


</header>


<p>The purpose of the code is to explore the relationship between various factors, such as age, region, and customer status, and the number of patents held by individuals or companies. It also aims to build a statistical model to predict the number of patents based on these factors.</p>
<p>The code takes a single input, which is a CSV file named “blueprinty.csv”. This file likely contains data about individuals or companies, including information such as their age, region, customer status, and the number of patents they hold.</p>
<p>The output of the code includes various visualizations and statistical summaries, as well as the results of a Poisson regression model that predicts the number of patents based on the input variables.</p>
<p>Here’s how the code achieves its purpose:</p>
<p>It starts by importing the necessary Python libraries, such as pandas for data manipulation, numpy for numerical operations, matplotlib and seaborn for data visualization, and statsmodels for statistical modeling.</p>
<p>The code reads the “blueprinty.csv” file into a pandas DataFrame called “blueprinty”.</p>
<p>It performs exploratory data analysis by printing the first few rows of the data, displaying information about the data types and columns, and calculating summary statistics like mean, median, and quartiles.</p>
<p>The code checks for missing values in the dataset.</p>
<p>It creates a histogram to visualize the distribution of the number of patents, grouped by customer status (whether the individual or company is a customer or not).</p>
<p>The code calculates and prints the mean number of patents for customers and non-customers separately.</p>
<p>It analyzes the distribution of regions and the mean age for customers and non-customers.</p>
<p>The code creates new columns in the DataFrame, such as “age_squared” and dummy variables for different regions, to be used as input variables for the regression model.</p>
<p>It fits a Poisson regression model using the statsmodels library, with the number of patents as the dependent variable and age, age squared, region dummies, and customer status as independent variables.</p>
<p>The code prints a summary of the regression results, including the estimated coefficients and their statistical significance.</p>
<p>It interprets the exponential of the coefficients, which represent the multiplicative effect of each variable on the expected number of patents.</p>
<p>Finally, the code creates additional visualizations to explore the distributions of age and region by customer status.</p>
<p>The code follows a logical flow, starting with data loading and exploration, followed by data preprocessing and feature engineering, and then building and interpreting the statistical model. It performs various data transformations, such as creating dummy variables and calculating squared terms, to prepare the data for the regression analysis.</p>
<p>The dataset has 1500 rows (entries). The “patents” column contains integer values ranging from 0 to 16, with a mean of around 3.68. The “age” column contains float values ranging from 9 to 49, with a mean of around 26.36. The “iscustomer” column is binary, with 0 representing non-customers and 1 representing customers. Around 13.13% of the entries are customers. There are no missing values in the dataset, as indicated by the “0” values in the last line of the output.</p>
<p>The purpose of the code is to explore the relationship between the number of patents held by individuals and their customer status, as well as other factors such as age and region. It also aims to build a statistical model to predict the number of patents based on these variables.</p>
<p>The code takes a single input, which is a CSV file named “blueprinty.csv”. This file is assumed to contain data with columns representing the number of patents, customer status (iscustomer), age, and region for a set of individuals.</p>
<p>The output of the code includes:</p>
<p>Exploratory data analysis results, such as summary statistics, missing value checks, and visualizations of the distribution of patents and other variables by customer status. Comparison of means and distributions of patents, age, and region between customers and non-customers. A fitted Poisson regression model that relates the number of patents to age, age squared, region (encoded as dummy variables), and customer status. The model coefficients and their exponential values, which can be interpreted as the multiplicative effect of each variable on the expected number of patents. Additional visualizations of the distribution of age and region by customer status. To achieve its purpose, the code follows these steps:</p>
<p>Import necessary Python libraries for data manipulation, visualization, and statistical modeling. Read the “blueprinty.csv” file into a pandas DataFrame named “blueprinty”. Perform exploratory data analysis by printing the first few rows, data types, summary statistics, and checking for missing values. Visualize the distribution of the number of patents by customer status using a histogram. Compare the mean number of patents between customers and non-customers. Analyze the distribution of regions and mean age by customer status. Create new columns in the DataFrame for age squared and region dummy variables. Fit a Poisson regression model using the statsmodels library, with the number of patents as the dependent variable and age, age squared, region dummies, and customer status as independent variables. Print the model summary and interpret the coefficients by taking their exponential. Visualize the distribution of age and region by customer status using histograms and bar plots. The key logic flows and data transformations happening in the code include:</p>
<p>Exploratory data analysis to understand the characteristics of the dataset and identify potential relationships between variables. Creation of new features (age squared and region dummies) to capture non-linear effects and categorical variables in the regression model. Fitting a Poisson regression model, which is suitable for modeling count data like the number of patents. Interpretation of model coefficients by taking their exponential, which provides the multiplicative effect of each variable on the expected number of patents.</p>
<div id="61646977" class="cell" data-execution_count="1">
<div class="sourceCode cell-code" id="cb1"><pre class="sourceCode python code-with-copy"><code class="sourceCode python"><span id="cb1-1"><a href="#cb1-1" aria-hidden="true" tabindex="-1"></a><span class="im">import</span> pandas <span class="im">as</span> pd</span>
<span id="cb1-2"><a href="#cb1-2" aria-hidden="true" tabindex="-1"></a><span class="im">import</span> numpy <span class="im">as</span> np</span>
<span id="cb1-3"><a href="#cb1-3" aria-hidden="true" tabindex="-1"></a><span class="im">import</span> matplotlib.pyplot <span class="im">as</span> plt</span>
<span id="cb1-4"><a href="#cb1-4" aria-hidden="true" tabindex="-1"></a><span class="im">import</span> seaborn <span class="im">as</span> sns</span>
<span id="cb1-5"><a href="#cb1-5" aria-hidden="true" tabindex="-1"></a><span class="im">import</span> statsmodels.api <span class="im">as</span> sm</span></code><button title="Copy to Clipboard" class="code-copy-button"><i class="bi"></i></button></pre></div>
</div>
<div id="75e93af8" class="cell" data-execution_count="2">
<div class="sourceCode cell-code" id="cb2"><pre class="sourceCode python code-with-copy"><code class="sourceCode python"><span id="cb2-1"><a href="#cb2-1" aria-hidden="true" tabindex="-1"></a>blueprinty <span class="op">=</span> pd.read_csv(<span class="st">"blueprinty.csv"</span>)</span></code><button title="Copy to Clipboard" class="code-copy-button"><i class="bi"></i></button></pre></div>
</div>
<div id="1342732b" class="cell" data-execution_count="3">
<div class="sourceCode cell-code" id="cb3"><pre class="sourceCode python code-with-copy"><code class="sourceCode python"><span id="cb3-1"><a href="#cb3-1" aria-hidden="true" tabindex="-1"></a><span class="bu">print</span>(blueprinty.head())</span>
<span id="cb3-2"><a href="#cb3-2" aria-hidden="true" tabindex="-1"></a><span class="bu">print</span>(blueprinty.info())</span>
<span id="cb3-3"><a href="#cb3-3" aria-hidden="true" tabindex="-1"></a><span class="bu">print</span>(blueprinty.describe())</span></code><button title="Copy to Clipboard" class="code-copy-button"><i class="bi"></i></button></pre></div>
<div class="cell-output cell-output-stdout">
<pre><code>   Unnamed: 0  patents     region   age  iscustomer
0           1        0    Midwest  32.5           0
1         786        3  Southwest  37.5           0
2         348        4  Northwest  27.0           1
3         927        3  Northeast  24.5           0
4         830        3  Southwest  37.0           0
&lt;class 'pandas.core.frame.DataFrame'&gt;
RangeIndex: 1500 entries, 0 to 1499
Data columns (total 5 columns):
 #   Column      Non-Null Count  Dtype  
---  ------      --------------  -----  
 0   Unnamed: 0  1500 non-null   int64  
 1   patents     1500 non-null   int64  
 2   region      1500 non-null   object 
 3   age         1500 non-null   float64
 4   iscustomer  1500 non-null   int64  
dtypes: float64(1), int64(3), object(1)
memory usage: 58.7+ KB
None
        Unnamed: 0      patents          age   iscustomer
count  1500.000000  1500.000000  1500.000000  1500.000000
mean    750.500000     3.684667    26.357667     0.131333
std     433.157015     2.352500     7.242528     0.337877
min       1.000000     0.000000     9.000000     0.000000
25%     375.750000     2.000000    21.000000     0.000000
50%     750.500000     3.000000    26.000000     0.000000
75%    1125.250000     5.000000    31.625000     0.000000
max    1500.000000    16.000000    49.000000     1.000000</code></pre>
</div>
</div>
<div id="adc3232f" class="cell" data-execution_count="4">
<div class="sourceCode cell-code" id="cb5"><pre class="sourceCode python code-with-copy"><code class="sourceCode python"><span id="cb5-1"><a href="#cb5-1" aria-hidden="true" tabindex="-1"></a><span class="bu">print</span>(blueprinty.isnull().<span class="bu">sum</span>())</span></code><button title="Copy to Clipboard" class="code-copy-button"><i class="bi"></i></button></pre></div>
<div class="cell-output cell-output-stdout">
<pre><code>Unnamed: 0    0
patents       0
region        0
age           0
iscustomer    0
dtype: int64</code></pre>
</div>
</div>
<div id="3c816e7a" class="cell" data-execution_count="5">
<div class="sourceCode cell-code" id="cb7"><pre class="sourceCode python code-with-copy"><code class="sourceCode python"><span id="cb7-1"><a href="#cb7-1" aria-hidden="true" tabindex="-1"></a><span class="co"># Visualize distribution of number of patents by customer status</span></span>
<span id="cb7-2"><a href="#cb7-2" aria-hidden="true" tabindex="-1"></a>plt.figure(figsize<span class="op">=</span>(<span class="dv">8</span>, <span class="dv">6</span>))</span>
<span id="cb7-3"><a href="#cb7-3" aria-hidden="true" tabindex="-1"></a>sns.histplot(data<span class="op">=</span>blueprinty, x<span class="op">=</span><span class="st">'patents'</span>, hue<span class="op">=</span><span class="st">'iscustomer'</span>, bins<span class="op">=</span><span class="dv">20</span>)</span>
<span id="cb7-4"><a href="#cb7-4" aria-hidden="true" tabindex="-1"></a>plt.xlabel(<span class="st">'Number of Patents'</span>)</span>
<span id="cb7-5"><a href="#cb7-5" aria-hidden="true" tabindex="-1"></a>plt.ylabel(<span class="st">'Count'</span>)</span>
<span id="cb7-6"><a href="#cb7-6" aria-hidden="true" tabindex="-1"></a>plt.title(<span class="st">'Distribution of Number of Patents by Customer Status'</span>)</span>
<span id="cb7-7"><a href="#cb7-7" aria-hidden="true" tabindex="-1"></a>plt.show()</span></code><button title="Copy to Clipboard" class="code-copy-button"><i class="bi"></i></button></pre></div>
<div class="cell-output cell-output-display">
<div>
<figure class="figure">
<p><img src="index_files/figure-html/cell-6-output-1.png" width="668" height="523" class="figure-img"></p>
</figure>
</div>
</div>
</div>
<div id="7a9492ec" class="cell" data-execution_count="6">
<div class="sourceCode cell-code" id="cb8"><pre class="sourceCode python code-with-copy"><code class="sourceCode python"><span id="cb8-1"><a href="#cb8-1" aria-hidden="true" tabindex="-1"></a><span class="co"># Compare means of number of patents by customer status</span></span>
<span id="cb8-2"><a href="#cb8-2" aria-hidden="true" tabindex="-1"></a><span class="bu">print</span>(<span class="st">"Mean number of patents for customers:"</span>, blueprinty[blueprinty[<span class="st">'iscustomer'</span>]<span class="op">==</span><span class="dv">1</span>][<span class="st">'patents'</span>].mean())</span>
<span id="cb8-3"><a href="#cb8-3" aria-hidden="true" tabindex="-1"></a><span class="bu">print</span>(<span class="st">"Mean number of patents for non-customers:"</span>, blueprinty[blueprinty[<span class="st">'iscustomer'</span>]<span class="op">==</span><span class="dv">0</span>][<span class="st">'patents'</span>].mean())</span>
<span id="cb8-4"><a href="#cb8-4" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb8-5"><a href="#cb8-5" aria-hidden="true" tabindex="-1"></a><span class="co"># Compare regions and ages by customer status</span></span>
<span id="cb8-6"><a href="#cb8-6" aria-hidden="true" tabindex="-1"></a><span class="bu">print</span>(<span class="st">"Region distribution for customers:"</span>)</span>
<span id="cb8-7"><a href="#cb8-7" aria-hidden="true" tabindex="-1"></a><span class="bu">print</span>(blueprinty[blueprinty[<span class="st">'iscustomer'</span>]<span class="op">==</span><span class="dv">1</span>][<span class="st">'region'</span>].value_counts(normalize<span class="op">=</span><span class="va">True</span>))</span>
<span id="cb8-8"><a href="#cb8-8" aria-hidden="true" tabindex="-1"></a><span class="bu">print</span>(<span class="st">"Region distribution for non-customers:"</span>)</span>
<span id="cb8-9"><a href="#cb8-9" aria-hidden="true" tabindex="-1"></a><span class="bu">print</span>(blueprinty[blueprinty[<span class="st">'iscustomer'</span>]<span class="op">==</span><span class="dv">0</span>][<span class="st">'region'</span>].value_counts(normalize<span class="op">=</span><span class="va">True</span>))</span>
<span id="cb8-10"><a href="#cb8-10" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb8-11"><a href="#cb8-11" aria-hidden="true" tabindex="-1"></a><span class="bu">print</span>(<span class="st">"Mean age for customers:"</span>, blueprinty[blueprinty[<span class="st">'iscustomer'</span>]<span class="op">==</span><span class="dv">1</span>][<span class="st">'age'</span>].mean())</span>
<span id="cb8-12"><a href="#cb8-12" aria-hidden="true" tabindex="-1"></a><span class="bu">print</span>(<span class="st">"Mean age for non-customers:"</span>, blueprinty[blueprinty[<span class="st">'iscustomer'</span>]<span class="op">==</span><span class="dv">0</span>][<span class="st">'age'</span>].mean())</span></code><button title="Copy to Clipboard" class="code-copy-button"><i class="bi"></i></button></pre></div>
<div class="cell-output cell-output-stdout">
<pre><code>Mean number of patents for customers: 4.091370558375634
Mean number of patents for non-customers: 3.6231772831926325
Region distribution for customers:
region
Northeast    0.573604
Southwest    0.157360
South        0.101523
Midwest      0.086294
Northwest    0.081218
Name: proportion, dtype: float64
Region distribution for non-customers:
region
Northeast    0.374520
Southwest    0.204144
Midwest      0.158864
Northwest    0.131236
South        0.131236
Name: proportion, dtype: float64
Mean age for customers: 24.1497461928934
Mean age for non-customers: 26.691481197237145</code></pre>
</div>
</div>
<p>The mean number of patents for customers (4.09) is higher than the mean number of patents for non-customers (3.62).</p>
<p>The distribution of regions for customers is different from the distribution for non-customers. For customers, the highest proportion is in the Northeast region (57.36%), followed by Southwest (15.74%), South (10.15%), Midwest (8.63%), and Northwest (8.12%). For non-customers, the highest proportion is also in the Northeast region (37.45%), followed by Southwest (20.41%), Midwest (15.89%), Northwest (13.12%), and South (13.12%).</p>
<p>The mean age for customers (24.15) is lower than the mean age for non-customers (26.69).</p>
<p>The output shows the summary of a Poisson regression model, which models the number of patents (the dependent variable) as a function of age, age squared, region dummies, and customer status (the independent variables).</p>
<p>The coefficient for the “iscustomer” variable is positive (0.1181) and statistically significant (p-value = 0.002), indicating that being a customer is associated with a higher expected number of patents, holding other variables constant.</p>
<p>The coefficients for age and age squared are positive and negative, respectively, suggesting a non-linear relationship between age and the number of patents.</p>
<p>The coefficients for the region dummies indicate that, compared to the reference region (Northwest), the Northeast region has a higher expected number of patents, while the other regions are not significantly different from the reference region.</p>
<p>The last part of the output shows the exponential of the coefficients, which can be interpreted as the multiplicative effect of each variable on the expected number of patents. For example, being a customer is associated with a 12.54% (exp(0.1181) - 1) increase in the expected number of patents, holding other variables constant.</p>
<p>Overall, this output provides insights into the relationship between various factors (age, region, customer status) and the number of patents held by individuals or companies in the dataset. The Poisson regression model quantifies these relationships and can be used to make predictions or understand the relative importance of different factors.</p>
<div id="ee70b202" class="cell" data-execution_count="7">
<div class="sourceCode cell-code" id="cb10"><pre class="sourceCode python code-with-copy"><code class="sourceCode python"><span id="cb10-1"><a href="#cb10-1" aria-hidden="true" tabindex="-1"></a>blueprinty[<span class="st">'age_squared'</span>] <span class="op">=</span> blueprinty[<span class="st">'age'</span>]<span class="op">**</span><span class="dv">2</span></span>
<span id="cb10-2"><a href="#cb10-2" aria-hidden="true" tabindex="-1"></a>blueprinty[<span class="st">'region_Midwest'</span>] <span class="op">=</span> (blueprinty[<span class="st">'region'</span>] <span class="op">==</span> <span class="st">'Midwest'</span>).astype(<span class="bu">int</span>)</span>
<span id="cb10-3"><a href="#cb10-3" aria-hidden="true" tabindex="-1"></a>blueprinty[<span class="st">'region_Northeast'</span>] <span class="op">=</span> (blueprinty[<span class="st">'region'</span>] <span class="op">==</span> <span class="st">'Northeast'</span>).astype(<span class="bu">int</span>)</span>
<span id="cb10-4"><a href="#cb10-4" aria-hidden="true" tabindex="-1"></a>blueprinty[<span class="st">'region_South'</span>] <span class="op">=</span> (blueprinty[<span class="st">'region'</span>] <span class="op">==</span> <span class="st">'South'</span>).astype(<span class="bu">int</span>)</span>
<span id="cb10-5"><a href="#cb10-5" aria-hidden="true" tabindex="-1"></a>blueprinty[<span class="st">'region_Southwest'</span>] <span class="op">=</span> (blueprinty[<span class="st">'region'</span>] <span class="op">==</span> <span class="st">'Southwest'</span>).astype(<span class="bu">int</span>)</span></code><button title="Copy to Clipboard" class="code-copy-button"><i class="bi"></i></button></pre></div>
</div>
<div id="f77df2c5" class="cell" data-execution_count="8">
<div class="sourceCode cell-code" id="cb11"><pre class="sourceCode python code-with-copy"><code class="sourceCode python"><span id="cb11-1"><a href="#cb11-1" aria-hidden="true" tabindex="-1"></a><span class="co"># Fit Poisson regression model</span></span>
<span id="cb11-2"><a href="#cb11-2" aria-hidden="true" tabindex="-1"></a>poisson_model <span class="op">=</span> sm.GLM(blueprinty[<span class="st">'patents'</span>], </span>
<span id="cb11-3"><a href="#cb11-3" aria-hidden="true" tabindex="-1"></a>                       sm.add_constant(blueprinty[[<span class="st">'age'</span>, <span class="st">'age_squared'</span>, <span class="st">'region_Midwest'</span>, </span>
<span id="cb11-4"><a href="#cb11-4" aria-hidden="true" tabindex="-1"></a>                                                   <span class="st">'region_Northeast'</span>, <span class="st">'region_South'</span>, </span>
<span id="cb11-5"><a href="#cb11-5" aria-hidden="true" tabindex="-1"></a>                                                   <span class="st">'region_Southwest'</span>, <span class="st">'iscustomer'</span>]]), </span>
<span id="cb11-6"><a href="#cb11-6" aria-hidden="true" tabindex="-1"></a>                       family<span class="op">=</span>sm.families.Poisson())</span>
<span id="cb11-7"><a href="#cb11-7" aria-hidden="true" tabindex="-1"></a>poisson_results <span class="op">=</span> poisson_model.fit()</span>
<span id="cb11-8"><a href="#cb11-8" aria-hidden="true" tabindex="-1"></a><span class="bu">print</span>(poisson_results.summary())</span>
<span id="cb11-9"><a href="#cb11-9" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb11-10"><a href="#cb11-10" aria-hidden="true" tabindex="-1"></a><span class="co"># Interpret model coefficients</span></span>
<span id="cb11-11"><a href="#cb11-11" aria-hidden="true" tabindex="-1"></a><span class="bu">print</span>(<span class="st">"Exponential of coefficients:"</span>)</span>
<span id="cb11-12"><a href="#cb11-12" aria-hidden="true" tabindex="-1"></a><span class="bu">print</span>(np.exp(poisson_results.params))</span></code><button title="Copy to Clipboard" class="code-copy-button"><i class="bi"></i></button></pre></div>
<div class="cell-output cell-output-stdout">
<pre><code>                 Generalized Linear Model Regression Results                  
==============================================================================
Dep. Variable:                patents   No. Observations:                 1500
Model:                            GLM   Df Residuals:                     1492
Model Family:                 Poisson   Df Model:                            7
Link Function:                    Log   Scale:                          1.0000
Method:                          IRLS   Log-Likelihood:                -3275.9
Date:                Thu, 30 May 2024   Deviance:                       2178.8
Time:                        13:12:28   Pearson chi2:                 2.11e+03
No. Iterations:                     5   Pseudo R-squ. (CS):             0.1152
Covariance Type:            nonrobust                                         
====================================================================================
                       coef    std err          z      P&gt;|z|      [0.025      0.975]
------------------------------------------------------------------------------------
const               -0.4714      0.184     -2.556      0.011      -0.833      -0.110
age                  0.1445      0.014     10.414      0.000       0.117       0.172
age_squared         -0.0029      0.000    -11.131      0.000      -0.003      -0.002
region_Midwest       0.0201      0.054      0.374      0.709      -0.085       0.126
region_Northeast     0.1187      0.045      2.639      0.008       0.031       0.207
region_South         0.0773      0.055      1.401      0.161      -0.031       0.185
region_Southwest     0.0714      0.050      1.432      0.152      -0.026       0.169
iscustomer           0.1181      0.039      3.035      0.002       0.042       0.194
====================================================================================
Exponential of coefficients:
const               0.624143
age                 1.155504
age_squared         0.997136
region_Midwest      1.020297
region_Northeast    1.126021
region_South        1.080330
region_Southwest    1.074055
iscustomer          1.125373
dtype: float64</code></pre>
</div>
</div>
<div id="cced7076" class="cell" data-execution_count="9">
<div class="sourceCode cell-code" id="cb13"><pre class="sourceCode python code-with-copy"><code class="sourceCode python"><span id="cb13-1"><a href="#cb13-1" aria-hidden="true" tabindex="-1"></a>plt.figure(figsize<span class="op">=</span>(<span class="dv">8</span>, <span class="dv">6</span>))</span>
<span id="cb13-2"><a href="#cb13-2" aria-hidden="true" tabindex="-1"></a>sns.histplot(data<span class="op">=</span>blueprinty, x<span class="op">=</span><span class="st">'age'</span>, hue<span class="op">=</span><span class="st">'iscustomer'</span>, bins<span class="op">=</span><span class="dv">20</span>)</span>
<span id="cb13-3"><a href="#cb13-3" aria-hidden="true" tabindex="-1"></a>plt.xlabel(<span class="st">'Age'</span>)</span>
<span id="cb13-4"><a href="#cb13-4" aria-hidden="true" tabindex="-1"></a>plt.ylabel(<span class="st">'Count'</span>)</span>
<span id="cb13-5"><a href="#cb13-5" aria-hidden="true" tabindex="-1"></a>plt.title(<span class="st">'Distribution of Age by Customer Status'</span>)</span>
<span id="cb13-6"><a href="#cb13-6" aria-hidden="true" tabindex="-1"></a>plt.show()</span></code><button title="Copy to Clipboard" class="code-copy-button"><i class="bi"></i></button></pre></div>
<div class="cell-output cell-output-display">
<div>
<figure class="figure">
<p><img src="index_files/figure-html/cell-10-output-1.png" width="668" height="523" class="figure-img"></p>
</figure>
</div>
</div>
</div>
<p>Region distribution by customer status:</p>
<p>For customers, the Northeast region has the highest proportion (57.36%), followed by Southwest (15.74%), South (10.15%), Midwest (8.63%), and Northwest (8.12%). For non-customers, the Northeast region also has the highest proportion (37.45%), but it is lower than the proportion for customers. The next highest proportions for non-customers are Southwest (20.41%), Midwest (15.89%), Northwest (13.12%), and South (13.12%). Mean age by customer status:</p>
<p>The mean age for customers is 24.15 years. The mean age for non-customers is 26.69 years, which is higher than the mean age for customers. From these observations, we can infer the following:</p>
<p>The Northeast region has a higher concentration of customers compared to non-customers, suggesting that the company’s products or services may be more popular or better marketed in this region.</p>
<p>The Southwest region also has a higher proportion of customers compared to non-customers, indicating that it could be another important market for the company.</p>
<p>The Midwest and Northwest regions have a lower proportion of customers compared to non-customers, which could mean that the company’s offerings are less popular or less accessible in these regions.</p>
<p>Customers tend to be younger, with a mean age of 24.15 years, compared to non-customers, who have a mean age of 26.69 years. This age difference could be due to various factors, such as the company’s products or services being more appealing to younger individuals, or younger people being more likely to become customers.</p>
<p>These observations can help the company identify potential target markets based on regional preferences and age demographics. For example, the company may want to focus more marketing efforts in the Northeast and Southwest regions, or tailor their products and services to better appeal to younger age groups.</p>
<p>The distribution of regions for customers and non-customers in the dataset.</p>
<p>For customers:</p>
<p>The Northeast region has the highest proportion of customers at 57.36%. The Southwest region has the second-highest proportion at 15.74%. The South region has a proportion of 10.15%. The Midwest region has a proportion of 8.63%. The Northwest region has the lowest proportion of customers at 8.12%. For non-customers:</p>
<p>The Northeast region also has the highest proportion of non-customers at 37.45%, but lower than the proportion for customers. The Southwest region has the second-highest proportion of non-customers at 20.41%, higher than the proportion for customers. The Midwest region has a proportion of 15.89%, higher than the proportion for customers. The Northwest region has a proportion of 13.12%, higher than the proportion for customers. The South region has a proportion of 13.12%, higher than the proportion for customers. In summary, the key differences in the regional distribution between customers and non-customers are:</p>
<p>The Northeast region has a significantly higher proportion of customers compared to non-customers. The Southwest region has a lower proportion of customers compared to non-customers. The Midwest, Northwest, and South regions have a lower proportion of customers compared to non-customers. This information suggests that the customer base is more concentrated in the Northeast region, while non-customers are more evenly distributed across regions, with a higher representation in the Southwest, Midwest, Northwest, and South regions compared to customers.</p>
<p>Avatar for sht025-vvakx Mean age for customers: 24.1497461928934 Mean age for non-customers: 26.691481197237145</p>
<p>The output you provided shows the mean age for customers and non-customers in the dataset.</p>
<p>For customers:</p>
<p>The mean age is 24.15 years. For non-customers:</p>
<p>The mean age is 26.69 years. This indicates that, on average, customers in the dataset are younger than non-customers.</p>
<p>Specifically:</p>
<p>The mean age for customers is approximately 24 years. The mean age for non-customers is approximately 27 years. The difference between the mean ages of customers and non-customers is around 2.5 years.</p>
<p>This information suggests that the customer base skews younger compared to the non-customer group. Potential reasons for this could be:</p>
<p>The product or service being offered may be more appealing or relevant to a younger demographic. Younger individuals or companies may be more likely to become customers for the particular offering. There could be differences in the age distribution of the target market for customers versus non-customers. However, it’s important to note that these are just potential explanations, and further analysis or additional context would be needed to draw more definitive conclusions about the relationship between age and customer status in this dataset</p>
<p>probability mass function (PMF) of the Poisson distribution, which is given by:</p>
<p><span class="math display">\[f(Y|\lambda) = \frac{e^{-\lambda}\lambda^Y}{Y!}\]</span></p>
<p>where:</p>
<p><span class="math inline">\(Y\)</span> is the random variable representing the number of events (in this case, the number of patents awarded) <span class="math inline">\(\lambda\)</span> is the rate parameter, which represents the average number of events in the given time or space interval <span class="math inline">\(e\)</span> is the base of the natural logarithm (approximately 2.71828) <span class="math inline">\(Y!\)</span> represents the factorial of <span class="math inline">\(Y\)</span> The likelihood function is the joint probability of observing the given data, treated as a function of the unknown parameter(s). In the case of the Poisson distribution, we have a single parameter <span class="math inline">\(\lambda\)</span>.</p>
<p>Suppose we have a sample of <span class="math inline">\(n\)</span> independent observations, <span class="math inline">\(y_1, y_2, \ldots, y_n\)</span>, where each <span class="math inline">\(y_i\)</span> represents the number of patents awarded to the <span class="math inline">\(i\)</span>-th engineering firm. The likelihood function for this sample is the product of the individual Poisson probabilities:</p>
<p><span class="math display">\[\mathcal{L}(\lambda|y_1, y_2, \ldots, y_n) = \prod_{i=1}^{n} f(y_i|\lambda)\]</span></p>
<p>Substituting the Poisson PMF, we get:</p>
<p><span class="math display">\[\mathcal{L}(\lambda|y_1, y_2, \ldots, y_n) = \prod_{i=1}^{n} \frac{e^{-\lambda}\lambda^{y_i}}{y_i!}\]</span></p>
<p>This likelihood function represents the joint probability of observing the data <span class="math inline">\(y_1, y_2, \ldots, y_n\)</span> given the parameter <span class="math inline">\(\lambda\)</span>. The maximum likelihood estimate (MLE) of <span class="math inline">\(\lambda\)</span> is the value that maximizes this likelihood function.</p>
<p>The Purpose: The code aims to provide an understanding of how to calculate the probability of observing a certain number of events (e.g., patents awarded) using the Poisson distribution, and how to find the maximum likelihood estimate (MLE) of the rate parameter (λ) given a set of observations.</p>
<p>Input(s): The code does not take any direct input. However, it assumes that you have a set of observations (y_1, y_2, …, y_n), where each observation represents the number of events (e.g., patents awarded) for a particular entity (e.g., engineering firm).</p>
<p>Output(s): The code does not produce a direct output. Instead, it provides the mathematical formulas and explanations for calculating the PMF and likelihood function, which can be used to find the MLE of the rate parameter (λ) based on the observed data.</p>
<p>How it achieves its purpose: a) The code first introduces the PMF (probability mass function) for the Poisson distribution, which gives the probability of observing a specific number of events (Y) given the rate parameter (λ). b) It then explains the likelihood function, which is the joint probability of observing the given data (y_1, y_2, …, y_n) treated as a function of the unknown parameter (λ). c) The likelihood function is calculated by multiplying the individual Poisson probabilities (PMFs) for each observation. d) The MLE of λ is the value that maximizes this likelihood function, meaning it is the value of λ that makes the observed data most likely to occur.</p>
<p>Important logic flows and data transformations: a) The code assumes that the observations (y_1, y_2, …, y_n) are independent and follow the Poisson distribution. b) It uses the product of individual Poisson probabilities (PMFs) to calculate the likelihood function. c) The goal is to find the value of λ that maximizes the likelihood function, which is the MLE of λ given the observed data.</p>
<p>The code provides a theoretical foundation for understanding and working with the Poisson distribution, which is useful in various applications where you need to model the occurrence of rare events or count data.</p>
<div id="c1318214" class="cell" data-execution_count="10">
<div class="sourceCode cell-code" id="cb14"><pre class="sourceCode python code-with-copy"><code class="sourceCode python"><span id="cb14-1"><a href="#cb14-1" aria-hidden="true" tabindex="-1"></a><span class="im">import</span> math</span>
<span id="cb14-2"><a href="#cb14-2" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb14-3"><a href="#cb14-3" aria-hidden="true" tabindex="-1"></a><span class="kw">def</span> poisson_loglikelihood(lmbda, Y):</span>
<span id="cb14-4"><a href="#cb14-4" aria-hidden="true" tabindex="-1"></a>    loglik <span class="op">=</span> <span class="bu">sum</span>(Y <span class="op">*</span> math.log(lmbda) <span class="op">-</span> lmbda <span class="op">-</span> math.lgamma(Y <span class="op">+</span> <span class="dv">1</span>))</span>
<span id="cb14-5"><a href="#cb14-5" aria-hidden="true" tabindex="-1"></a>    <span class="cf">return</span> loglik</span></code><button title="Copy to Clipboard" class="code-copy-button"><i class="bi"></i></button></pre></div>
</div>
<p>The poisson_loglikelihood function calculates the log-likelihood of observing a set of data points (Y) given a specific rate parameter (lmbda) for the Poisson distribution.</p>
<p>The function takes two inputs:</p>
<p>lmbda: The rate parameter of the Poisson distribution, which represents the average number of events occurring in a fixed interval. Y: A list or array of observed data points, which are assumed to be counts or non-negative integers. The output of the function is a single numerical value representing the log-likelihood of observing the data Y given the rate parameter lmbda.</p>
<p>Here’s how the function achieves its purpose:</p>
<p>It initializes a variable loglik to 0. For each data point y in Y, it calculates the log-likelihood contribution using the formula: y * log(lmbda) - lmbda - log(y!), where log(y!) is calculated using the math.lgamma function, which computes the log of the gamma function. The log-likelihood contributions for all data points are summed up and stored in the loglik variable. Finally, the function returns the total log-likelihood value. The log-likelihood function is commonly used in statistical modeling and parameter estimation tasks. By maximizing the log-likelihood (or minimizing the negative log-likelihood), one can find the optimal value of the rate parameter lmbda that best explains the observed data Y under the assumption of a Poisson distribution.</p>
<p>It’s important to note that this function assumes that the data points in Y are independent and identically distributed (i.i.d.) according to the Poisson distribution with the given rate parameter lmbda.</p>
<div id="ec88e429" class="cell" data-execution_count="11">
<div class="sourceCode cell-code" id="cb15"><pre class="sourceCode python code-with-copy"><code class="sourceCode python"><span id="cb15-1"><a href="#cb15-1" aria-hidden="true" tabindex="-1"></a><span class="co"># Load the data</span></span>
<span id="cb15-2"><a href="#cb15-2" aria-hidden="true" tabindex="-1"></a>data <span class="op">=</span> pd.read_csv(<span class="st">"blueprinty.csv"</span>)</span>
<span id="cb15-3"><a href="#cb15-3" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb15-4"><a href="#cb15-4" aria-hidden="true" tabindex="-1"></a><span class="co"># Get the observed number of patents</span></span>
<span id="cb15-5"><a href="#cb15-5" aria-hidden="true" tabindex="-1"></a>Y <span class="op">=</span> data[<span class="st">"patents"</span>].values</span>
<span id="cb15-6"><a href="#cb15-6" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb15-7"><a href="#cb15-7" aria-hidden="true" tabindex="-1"></a><span class="co"># Define a range of lambda values</span></span>
<span id="cb15-8"><a href="#cb15-8" aria-hidden="true" tabindex="-1"></a>lambda_values <span class="op">=</span> np.linspace(<span class="fl">0.1</span>, <span class="dv">20</span>, <span class="dv">100</span>)</span>
<span id="cb15-9"><a href="#cb15-9" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb15-10"><a href="#cb15-10" aria-hidden="true" tabindex="-1"></a><span class="co"># Calculate the log-likelihood for each lambda value</span></span>
<span id="cb15-11"><a href="#cb15-11" aria-hidden="true" tabindex="-1"></a><span class="kw">def</span> poisson_loglikelihood(lamb, Y):</span>
<span id="cb15-12"><a href="#cb15-12" aria-hidden="true" tabindex="-1"></a>    <span class="cf">return</span> np.<span class="bu">sum</span>(Y <span class="op">*</span> np.log(lamb) <span class="op">-</span> lamb)</span>
<span id="cb15-13"><a href="#cb15-13" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb15-14"><a href="#cb15-14" aria-hidden="true" tabindex="-1"></a>log_likelihoods <span class="op">=</span> [poisson_loglikelihood(lamb, Y) <span class="cf">for</span> lamb <span class="kw">in</span> lambda_values]</span>
<span id="cb15-15"><a href="#cb15-15" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb15-16"><a href="#cb15-16" aria-hidden="true" tabindex="-1"></a><span class="co"># Plot the log-likelihood against lambda</span></span>
<span id="cb15-17"><a href="#cb15-17" aria-hidden="true" tabindex="-1"></a>plt.figure(figsize<span class="op">=</span>(<span class="dv">10</span>, <span class="dv">6</span>))</span>
<span id="cb15-18"><a href="#cb15-18" aria-hidden="true" tabindex="-1"></a>plt.plot(lambda_values, log_likelihoods)</span>
<span id="cb15-19"><a href="#cb15-19" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb15-20"><a href="#cb15-20" aria-hidden="true" tabindex="-1"></a>plt.xlabel(<span class="st">"Lambda"</span>)</span>
<span id="cb15-21"><a href="#cb15-21" aria-hidden="true" tabindex="-1"></a>plt.ylabel(<span class="st">"Log-likelihood"</span>)</span>
<span id="cb15-22"><a href="#cb15-22" aria-hidden="true" tabindex="-1"></a>plt.title(<span class="st">"Log-likelihood of Poisson Distribution"</span>)</span>
<span id="cb15-23"><a href="#cb15-23" aria-hidden="true" tabindex="-1"></a>plt.show()</span>
<span id="cb15-24"><a href="#cb15-24" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb15-25"><a href="#cb15-25" aria-hidden="true" tabindex="-1"></a><span class="co"># Define a range of lambda values</span></span>
<span id="cb15-26"><a href="#cb15-26" aria-hidden="true" tabindex="-1"></a>lambda_values <span class="op">=</span> np.linspace(<span class="fl">0.1</span>, <span class="dv">20</span>, <span class="dv">100</span>)</span>
<span id="cb15-27"><a href="#cb15-27" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb15-28"><a href="#cb15-28" aria-hidden="true" tabindex="-1"></a><span class="co"># Calculate the log-likelihood for each lambda value</span></span>
<span id="cb15-29"><a href="#cb15-29" aria-hidden="true" tabindex="-1"></a>log_likelihoods <span class="op">=</span> [poisson_loglikelihood(lamb, Y) <span class="cf">for</span> lamb <span class="kw">in</span> lambda_values]</span></code><button title="Copy to Clipboard" class="code-copy-button"><i class="bi"></i></button></pre></div>
<div class="cell-output cell-output-display">
<div>
<figure class="figure">
<p><img src="index_files/figure-html/cell-12-output-1.png" width="845" height="523" class="figure-img"></p>
</figure>
</div>
</div>
</div>
<p>finding the maximum likelihood estimate (MLE) for the parameter (lambda) of a Poisson distribution, given some observed data.</p>
<p>The purpose of the code is to plot the log-likelihood function for a range of lambda values, which will help identify the value of lambda that maximizes the likelihood of observing the given data under the Poisson distribution assumption.</p>
<p>The input to the code is a CSV file named “blueprinty.csv”, which contains a column named “patents”. The code reads this file and extracts the values in the “patents” column as the observed data (Y).</p>
<p>The output of the code is a plot that shows the log-likelihood values for different lambda values. The lambda value that corresponds to the maximum log-likelihood value is the MLE for the Poisson distribution parameter.</p>
<p>Here’s how the code achieves its purpose: a) It first loads the data from the CSV file into a pandas DataFrame and extracts the “patents” column as a NumPy array (Y). b) It defines a range of lambda values (from 0.1 to 20, with 100 values in between) using np.linspace(). c) It defines a function poisson_loglikelihood() that calculates the log-likelihood of the Poisson distribution for a given lambda value and the observed data (Y). d) It uses a list comprehension to calculate the log-likelihood for each lambda value in the defined range, storing the results in the log_likelihoods list. e) Finally, it plots the lambda values on the x-axis and the corresponding log-likelihood values on the y-axis using matplotlib.pyplot.</p>
<p>The key logic flow and data transformation happening in the code are: a) Reading the data from a CSV file and extracting the relevant column as a NumPy array. b) Defining a range of lambda values to evaluate the log-likelihood function. c) Calculating the log-likelihood for each lambda value using the Poisson distribution formula and the observed data. d) Plotting the log-likelihood values against the corresponding lambda values to visualize the log-likelihood function.</p>
<p>The code assumes that the observed data (Y) follows a Poisson distribution, and it aims to find the value of the lambda parameter that maximizes the likelihood of observing the given data under this assumption. The plot produced by the code can be used to identify the MLE for lambda visually, as it will correspond to the peak of the log-likelihood curve.</p>
<div id="d5597452" class="cell" data-execution_count="12">
<div class="sourceCode cell-code" id="cb16"><pre class="sourceCode python code-with-copy"><code class="sourceCode python"><span id="cb16-1"><a href="#cb16-1" aria-hidden="true" tabindex="-1"></a>ybar <span class="op">=</span> <span class="dv">0</span></span>
<span id="cb16-2"><a href="#cb16-2" aria-hidden="true" tabindex="-1"></a>_todlambda_mle <span class="op">=</span> ybar</span></code><button title="Copy to Clipboard" class="code-copy-button"><i class="bi"></i></button></pre></div>
</div>
<div id="85d01acc" class="cell" data-execution_count="13">
<div class="sourceCode cell-code" id="cb17"><pre class="sourceCode python code-with-copy"><code class="sourceCode python"><span id="cb17-1"><a href="#cb17-1" aria-hidden="true" tabindex="-1"></a><span class="im">import</span> scipy <span class="im">as</span> sp</span>
<span id="cb17-2"><a href="#cb17-2" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb17-3"><a href="#cb17-3" aria-hidden="true" tabindex="-1"></a><span class="kw">def</span> likelihood(params, data):</span>
<span id="cb17-4"><a href="#cb17-4" aria-hidden="true" tabindex="-1"></a>    mu, sigma <span class="op">=</span> params</span>
<span id="cb17-5"><a href="#cb17-5" aria-hidden="true" tabindex="-1"></a>    prob <span class="op">=</span> sp.stats.norm(mu, sigma).pdf(data)</span>
<span id="cb17-6"><a href="#cb17-6" aria-hidden="true" tabindex="-1"></a>    <span class="cf">return</span> np.prod(prob)</span>
<span id="cb17-7"><a href="#cb17-7" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb17-8"><a href="#cb17-8" aria-hidden="true" tabindex="-1"></a>data <span class="op">=</span> [<span class="dv">1</span>, <span class="dv">2</span>, <span class="dv">3</span>, <span class="dv">4</span>, <span class="dv">5</span>] </span>
<span id="cb17-9"><a href="#cb17-9" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb17-10"><a href="#cb17-10" aria-hidden="true" tabindex="-1"></a>res <span class="op">=</span> sp.optimize.minimize(<span class="kw">lambda</span> params: <span class="op">-</span>likelihood(params, data), [<span class="dv">0</span>, <span class="dv">1</span>])</span>
<span id="cb17-11"><a href="#cb17-11" aria-hidden="true" tabindex="-1"></a>mu_mle, sigma_mle <span class="op">=</span> res.x</span>
<span id="cb17-12"><a href="#cb17-12" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb17-13"><a href="#cb17-13" aria-hidden="true" tabindex="-1"></a><span class="bu">print</span>(<span class="st">"MLE for mu:"</span>, mu_mle)</span>
<span id="cb17-14"><a href="#cb17-14" aria-hidden="true" tabindex="-1"></a><span class="bu">print</span>(<span class="st">"MLE for sigma:"</span>, sigma_mle)</span></code><button title="Copy to Clipboard" class="code-copy-button"><i class="bi"></i></button></pre></div>
<div class="cell-output cell-output-stdout">
<pre><code>MLE for mu: 0.0
MLE for sigma: 1.0</code></pre>
</div>
</div>
<p>It appears that the maximum likelihood estimates (MLEs) for the mean (μ) and standard deviation (σ) of the normal distribution, given the input data [1, 2, 3, 4, 5], are 0.0 and 1.0, respectively.</p>
<p>This result seems counterintuitive because the sample mean of the input data is 3.0, and the sample standard deviation is approximately 1.41. However, it’s important to note that the maximum likelihood estimation (MLE) method does not necessarily produce the same results as the sample mean and sample standard deviation, especially for small sample sizes or when the data does not closely follow a normal distribution.</p>
<p>estimates the maximum likelihood estimates (MLEs) of the parameters (mean and standard deviation) of a normal distribution, given a set of data points.</p>
<p>The Purpose of the Code: The primary purpose of this code is to find the values of the mean (μ) and standard deviation (σ) that maximize the likelihood of observing the given data points, assuming that the data points are drawn from a normal (Gaussian) distribution.</p>
<p>Input(s): The code takes a list of data points as input. In the provided example, the data is a list of five numbers: [1, 2, 3, 4, 5].</p>
<p>Output(s): The code outputs the maximum likelihood estimates (MLEs) of the mean (μ) and standard deviation (σ) for the given data points.</p>
<p>How it Achieves its Purpose: The code defines a function called likelihood that calculates the likelihood of observing the given data points for a particular set of parameters (mean and standard deviation). The likelihood is calculated by multiplying the probability density function (PDF) of the normal distribution, evaluated at each data point, using the given parameters.</p>
<p>The scipy.optimize.minimize function is then used to find the values of the mean and standard deviation that maximize the likelihood function. The minimize function takes two arguments: the first is a function to be minimized (in this case, the negative of the likelihood function), and the second is an initial guess for the parameters (in this case, [0, 1] for the mean and standard deviation, respectively).</p>
<p>The minimize function uses an optimization algorithm to iteratively adjust the parameter values until it finds the values that minimize the negative likelihood function, which is equivalent to maximizing the likelihood function itself.</p>
<p>Important Logic Flows and Data Transformations: a) The likelihood function calculates the probability density function (PDF) of the normal distribution for each data point, using the given parameters (mean and standard deviation). b) The individual PDF values are multiplied together to obtain the overall likelihood of observing the entire dataset under the assumed normal distribution with the given parameters. c) The scipy.optimize.minimize function is used to find the parameter values (mean and standard deviation) that maximize the likelihood function by minimizing the negative of the likelihood function. d) The optimization algorithm iteratively adjusts the parameter values until it converges to the maximum likelihood estimates (MLEs) for the mean and standard deviation. The code assumes that the input data points are drawn from a normal distribution and uses the maximum likelihood estimation technique to estimate the parameters of that distribution based on the observed data.</p>
<div id="7597b2a4" class="cell" data-execution_count="14">
<div class="sourceCode cell-code" id="cb19"><pre class="sourceCode python code-with-copy"><code class="sourceCode python"><span id="cb19-1"><a href="#cb19-1" aria-hidden="true" tabindex="-1"></a><span class="im">import</span> pandas <span class="im">as</span> pd</span>
<span id="cb19-2"><a href="#cb19-2" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb19-3"><a href="#cb19-3" aria-hidden="true" tabindex="-1"></a><span class="co"># Assuming data is a list</span></span>
<span id="cb19-4"><a href="#cb19-4" aria-hidden="true" tabindex="-1"></a>data <span class="op">=</span> [[<span class="dv">1</span>, <span class="dv">2</span>], [<span class="dv">3</span>, <span class="dv">4</span>], [<span class="dv">5</span>, <span class="dv">6</span>]]</span>
<span id="cb19-5"><a href="#cb19-5" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb19-6"><a href="#cb19-6" aria-hidden="true" tabindex="-1"></a><span class="co"># Convert the list to a DataFrame</span></span>
<span id="cb19-7"><a href="#cb19-7" aria-hidden="true" tabindex="-1"></a>df <span class="op">=</span> pd.DataFrame(data, columns<span class="op">=</span>[<span class="st">'column_1'</span>, <span class="st">'column_2'</span>])</span>
<span id="cb19-8"><a href="#cb19-8" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb19-9"><a href="#cb19-9" aria-hidden="true" tabindex="-1"></a><span class="co"># Now you can access the shape</span></span>
<span id="cb19-10"><a href="#cb19-10" aria-hidden="true" tabindex="-1"></a><span class="bu">print</span>(df.shape)  <span class="co"># Output: (3, 2)</span></span></code><button title="Copy to Clipboard" class="code-copy-button"><i class="bi"></i></button></pre></div>
<div class="cell-output cell-output-stdout">
<pre><code>(3, 2)</code></pre>
</div>
</div>
<div id="3bbac54b" class="cell" data-execution_count="15">
<div class="sourceCode cell-code" id="cb21"><pre class="sourceCode python code-with-copy"><code class="sourceCode python"><span id="cb21-1"><a href="#cb21-1" aria-hidden="true" tabindex="-1"></a><span class="im">import</span> pandas <span class="im">as</span> pd</span>
<span id="cb21-2"><a href="#cb21-2" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb21-3"><a href="#cb21-3" aria-hidden="true" tabindex="-1"></a><span class="co"># Assuming data is a 2D list or NumPy array with shape (3, 2)</span></span>
<span id="cb21-4"><a href="#cb21-4" aria-hidden="true" tabindex="-1"></a>df <span class="op">=</span> pd.DataFrame(data, columns<span class="op">=</span>[<span class="st">'column_name_1'</span>, <span class="st">'column_name_2'</span>])</span></code><button title="Copy to Clipboard" class="code-copy-button"><i class="bi"></i></button></pre></div>
</div>
<div id="e8082d25" class="cell" data-execution_count="16">
<div class="sourceCode cell-code" id="cb22"><pre class="sourceCode python code-with-copy"><code class="sourceCode python"><span id="cb22-1"><a href="#cb22-1" aria-hidden="true" tabindex="-1"></a><span class="bu">print</span>(df.shape)</span>
<span id="cb22-2"><a href="#cb22-2" aria-hidden="true" tabindex="-1"></a><span class="bu">print</span>(df.columns)</span></code><button title="Copy to Clipboard" class="code-copy-button"><i class="bi"></i></button></pre></div>
<div class="cell-output cell-output-stdout">
<pre><code>(3, 2)
Index(['column_name_1', 'column_name_2'], dtype='object')</code></pre>
</div>
</div>
<div id="7ea32602" class="cell" data-execution_count="17">
<div class="sourceCode cell-code" id="cb24"><pre class="sourceCode python code-with-copy"><code class="sourceCode python"><span id="cb24-1"><a href="#cb24-1" aria-hidden="true" tabindex="-1"></a>y <span class="op">=</span> df[<span class="st">'column_name_1'</span>]</span>
<span id="cb24-2"><a href="#cb24-2" aria-hidden="true" tabindex="-1"></a>X <span class="op">=</span> df[[<span class="st">'column_name_2'</span>]]</span></code><button title="Copy to Clipboard" class="code-copy-button"><i class="bi"></i></button></pre></div>
</div>
<div id="db6236fd" class="cell" data-execution_count="18">
<div class="sourceCode cell-code" id="cb25"><pre class="sourceCode python code-with-copy"><code class="sourceCode python"><span id="cb25-1"><a href="#cb25-1" aria-hidden="true" tabindex="-1"></a><span class="im">import</span> numpy <span class="im">as</span> np</span>
<span id="cb25-2"><a href="#cb25-2" aria-hidden="true" tabindex="-1"></a><span class="im">from</span> scipy.optimize <span class="im">import</span> minimize</span>
<span id="cb25-3"><a href="#cb25-3" aria-hidden="true" tabindex="-1"></a><span class="im">from</span> typing <span class="im">import</span> Tuple</span>
<span id="cb25-4"><a href="#cb25-4" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb25-5"><a href="#cb25-5" aria-hidden="true" tabindex="-1"></a><span class="kw">def</span> log_factorial(n):</span>
<span id="cb25-6"><a href="#cb25-6" aria-hidden="true" tabindex="-1"></a>    <span class="co">"""</span></span>
<span id="cb25-7"><a href="#cb25-7" aria-hidden="true" tabindex="-1"></a><span class="co">    Calculate the natural logarithm of the factorial of a non-negative integer n.</span></span>
<span id="cb25-8"><a href="#cb25-8" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb25-9"><a href="#cb25-9" aria-hidden="true" tabindex="-1"></a><span class="co">    Args:</span></span>
<span id="cb25-10"><a href="#cb25-10" aria-hidden="true" tabindex="-1"></a><span class="co">        n (int): Non-negative integer.</span></span>
<span id="cb25-11"><a href="#cb25-11" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb25-12"><a href="#cb25-12" aria-hidden="true" tabindex="-1"></a><span class="co">    Returns:</span></span>
<span id="cb25-13"><a href="#cb25-13" aria-hidden="true" tabindex="-1"></a><span class="co">        float: Natural logarithm of the factorial of n.</span></span>
<span id="cb25-14"><a href="#cb25-14" aria-hidden="true" tabindex="-1"></a><span class="co">    """</span></span>
<span id="cb25-15"><a href="#cb25-15" aria-hidden="true" tabindex="-1"></a>    result <span class="op">=</span> <span class="fl">0.0</span></span>
<span id="cb25-16"><a href="#cb25-16" aria-hidden="true" tabindex="-1"></a>    <span class="cf">for</span> i <span class="kw">in</span> <span class="bu">range</span>(<span class="dv">1</span>, n <span class="op">+</span> <span class="dv">1</span>):</span>
<span id="cb25-17"><a href="#cb25-17" aria-hidden="true" tabindex="-1"></a>        result <span class="op">+=</span> np.log(i)</span>
<span id="cb25-18"><a href="#cb25-18" aria-hidden="true" tabindex="-1"></a>    <span class="cf">return</span> result</span>
<span id="cb25-19"><a href="#cb25-19" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb25-20"><a href="#cb25-20" aria-hidden="true" tabindex="-1"></a><span class="kw">def</span> negative_poisson_log_likelihood(beta: np.ndarray, Y: np.ndarray, X: np.ndarray) <span class="op">-&gt;</span> <span class="bu">float</span>:</span>
<span id="cb25-21"><a href="#cb25-21" aria-hidden="true" tabindex="-1"></a>    <span class="co">"""</span></span>
<span id="cb25-22"><a href="#cb25-22" aria-hidden="true" tabindex="-1"></a><span class="co">    Calculate the negative log-likelihood for Poisson regression.</span></span>
<span id="cb25-23"><a href="#cb25-23" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb25-24"><a href="#cb25-24" aria-hidden="true" tabindex="-1"></a><span class="co">    Args:</span></span>
<span id="cb25-25"><a href="#cb25-25" aria-hidden="true" tabindex="-1"></a><span class="co">        beta (np.ndarray): Coefficients of the Poisson regression model.</span></span>
<span id="cb25-26"><a href="#cb25-26" aria-hidden="true" tabindex="-1"></a><span class="co">        Y (np.ndarray): Observed response variable (counts).</span></span>
<span id="cb25-27"><a href="#cb25-27" aria-hidden="true" tabindex="-1"></a><span class="co">        X (np.ndarray): Covariate matrix (design matrix).</span></span>
<span id="cb25-28"><a href="#cb25-28" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb25-29"><a href="#cb25-29" aria-hidden="true" tabindex="-1"></a><span class="co">    Returns:</span></span>
<span id="cb25-30"><a href="#cb25-30" aria-hidden="true" tabindex="-1"></a><span class="co">        float: Negative log-likelihood value.</span></span>
<span id="cb25-31"><a href="#cb25-31" aria-hidden="true" tabindex="-1"></a><span class="co">    """</span></span>
<span id="cb25-32"><a href="#cb25-32" aria-hidden="true" tabindex="-1"></a>    <span class="co"># Calculate lambda for each observation</span></span>
<span id="cb25-33"><a href="#cb25-33" aria-hidden="true" tabindex="-1"></a>    lambda_i <span class="op">=</span> np.exp(X <span class="op">@</span> beta)</span>
<span id="cb25-34"><a href="#cb25-34" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb25-35"><a href="#cb25-35" aria-hidden="true" tabindex="-1"></a>    <span class="co"># Calculate the negative log-likelihood</span></span>
<span id="cb25-36"><a href="#cb25-36" aria-hidden="true" tabindex="-1"></a>    log_factorials <span class="op">=</span> np.array([log_factorial(y) <span class="cf">for</span> y <span class="kw">in</span> Y])</span>
<span id="cb25-37"><a href="#cb25-37" aria-hidden="true" tabindex="-1"></a>    neg_log_likelihood <span class="op">=</span> <span class="op">-</span>np.<span class="bu">sum</span>(Y <span class="op">*</span> np.log(lambda_i) <span class="op">-</span> lambda_i <span class="op">-</span> log_factorials)</span>
<span id="cb25-38"><a href="#cb25-38" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb25-39"><a href="#cb25-39" aria-hidden="true" tabindex="-1"></a>    <span class="cf">return</span> neg_log_likelihood</span>
<span id="cb25-40"><a href="#cb25-40" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb25-41"><a href="#cb25-41" aria-hidden="true" tabindex="-1"></a><span class="kw">def</span> negative_poisson_log_likelihood_grad(beta: np.ndarray, Y: np.ndarray, X: np.ndarray) <span class="op">-&gt;</span> np.ndarray:</span>
<span id="cb25-42"><a href="#cb25-42" aria-hidden="true" tabindex="-1"></a>    <span class="co">"""</span></span>
<span id="cb25-43"><a href="#cb25-43" aria-hidden="true" tabindex="-1"></a><span class="co">    Calculate the gradient of the negative log-likelihood for Poisson regression.</span></span>
<span id="cb25-44"><a href="#cb25-44" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb25-45"><a href="#cb25-45" aria-hidden="true" tabindex="-1"></a><span class="co">    Args:</span></span>
<span id="cb25-46"><a href="#cb25-46" aria-hidden="true" tabindex="-1"></a><span class="co">        beta (np.ndarray): Coefficients of the Poisson regression model.</span></span>
<span id="cb25-47"><a href="#cb25-47" aria-hidden="true" tabindex="-1"></a><span class="co">        Y (np.ndarray): Observed response variable (counts).</span></span>
<span id="cb25-48"><a href="#cb25-48" aria-hidden="true" tabindex="-1"></a><span class="co">        X (np.ndarray): Covariate matrix (design matrix).</span></span>
<span id="cb25-49"><a href="#cb25-49" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb25-50"><a href="#cb25-50" aria-hidden="true" tabindex="-1"></a><span class="co">    Returns:</span></span>
<span id="cb25-51"><a href="#cb25-51" aria-hidden="true" tabindex="-1"></a><span class="co">        np.ndarray: Gradient of the negative log-likelihood.</span></span>
<span id="cb25-52"><a href="#cb25-52" aria-hidden="true" tabindex="-1"></a><span class="co">    """</span></span>
<span id="cb25-53"><a href="#cb25-53" aria-hidden="true" tabindex="-1"></a>    <span class="co"># Calculate lambda for each observation</span></span>
<span id="cb25-54"><a href="#cb25-54" aria-hidden="true" tabindex="-1"></a>    lambda_i <span class="op">=</span> np.exp(X <span class="op">@</span> beta)</span>
<span id="cb25-55"><a href="#cb25-55" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb25-56"><a href="#cb25-56" aria-hidden="true" tabindex="-1"></a>    <span class="co"># Calculate the gradient of the negative log-likelihood</span></span>
<span id="cb25-57"><a href="#cb25-57" aria-hidden="true" tabindex="-1"></a>    grad <span class="op">=</span> X.T <span class="op">@</span> (lambda_i <span class="op">-</span> Y)</span>
<span id="cb25-58"><a href="#cb25-58" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb25-59"><a href="#cb25-59" aria-hidden="true" tabindex="-1"></a>    <span class="cf">return</span> grad</span>
<span id="cb25-60"><a href="#cb25-60" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb25-61"><a href="#cb25-61" aria-hidden="true" tabindex="-1"></a><span class="kw">def</span> negative_poisson_log_likelihood_hess(beta: np.ndarray, Y: np.ndarray, X: np.ndarray) <span class="op">-&gt;</span> np.ndarray:</span>
<span id="cb25-62"><a href="#cb25-62" aria-hidden="true" tabindex="-1"></a>    <span class="co">"""</span></span>
<span id="cb25-63"><a href="#cb25-63" aria-hidden="true" tabindex="-1"></a><span class="co">    Calculate the Hessian matrix of the negative log-likelihood for Poisson regression.</span></span>
<span id="cb25-64"><a href="#cb25-64" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb25-65"><a href="#cb25-65" aria-hidden="true" tabindex="-1"></a><span class="co">    Args:</span></span>
<span id="cb25-66"><a href="#cb25-66" aria-hidden="true" tabindex="-1"></a><span class="co">        beta (np.ndarray): Coefficients of the Poisson regression model.</span></span>
<span id="cb25-67"><a href="#cb25-67" aria-hidden="true" tabindex="-1"></a><span class="co">        Y (np.ndarray): Observed response variable (counts).</span></span>
<span id="cb25-68"><a href="#cb25-68" aria-hidden="true" tabindex="-1"></a><span class="co">        X (np.ndarray): Covariate matrix (design matrix).</span></span>
<span id="cb25-69"><a href="#cb25-69" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb25-70"><a href="#cb25-70" aria-hidden="true" tabindex="-1"></a><span class="co">    Returns:</span></span>
<span id="cb25-71"><a href="#cb25-71" aria-hidden="true" tabindex="-1"></a><span class="co">        np.ndarray: Hessian matrix of the negative log-likelihood.</span></span>
<span id="cb25-72"><a href="#cb25-72" aria-hidden="true" tabindex="-1"></a><span class="co">    """</span></span>
<span id="cb25-73"><a href="#cb25-73" aria-hidden="true" tabindex="-1"></a>    <span class="co"># Calculate lambda for each observation</span></span>
<span id="cb25-74"><a href="#cb25-74" aria-hidden="true" tabindex="-1"></a>    lambda_i <span class="op">=</span> np.exp(X <span class="op">@</span> beta)</span>
<span id="cb25-75"><a href="#cb25-75" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb25-76"><a href="#cb25-76" aria-hidden="true" tabindex="-1"></a>    <span class="co"># Calculate the diagonal elements of the Hessian matrix</span></span>
<span id="cb25-77"><a href="#cb25-77" aria-hidden="true" tabindex="-1"></a>    diag_elements <span class="op">=</span> lambda_i</span>
<span id="cb25-78"><a href="#cb25-78" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb25-79"><a href="#cb25-79" aria-hidden="true" tabindex="-1"></a>    <span class="co"># Construct the Hessian matrix</span></span>
<span id="cb25-80"><a href="#cb25-80" aria-hidden="true" tabindex="-1"></a>    Hessian <span class="op">=</span> X.T <span class="op">@</span> np.diag(diag_elements) <span class="op">@</span> X</span>
<span id="cb25-81"><a href="#cb25-81" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb25-82"><a href="#cb25-82" aria-hidden="true" tabindex="-1"></a>    <span class="cf">return</span> Hessian</span>
<span id="cb25-83"><a href="#cb25-83" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb25-84"><a href="#cb25-84" aria-hidden="true" tabindex="-1"></a><span class="kw">def</span> fit_poisson_regression(Y: np.ndarray, X: np.ndarray) <span class="op">-&gt;</span> Tuple[np.ndarray, np.ndarray]:</span>
<span id="cb25-85"><a href="#cb25-85" aria-hidden="true" tabindex="-1"></a>    <span class="co">"""</span></span>
<span id="cb25-86"><a href="#cb25-86" aria-hidden="true" tabindex="-1"></a><span class="co">    Fit a Poisson regression model using maximum likelihood estimation.</span></span>
<span id="cb25-87"><a href="#cb25-87" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb25-88"><a href="#cb25-88" aria-hidden="true" tabindex="-1"></a><span class="co">    Args:</span></span>
<span id="cb25-89"><a href="#cb25-89" aria-hidden="true" tabindex="-1"></a><span class="co">        Y (np.ndarray): Observed response variable (counts).</span></span>
<span id="cb25-90"><a href="#cb25-90" aria-hidden="true" tabindex="-1"></a><span class="co">        X (np.ndarray): Covariate matrix (design matrix).</span></span>
<span id="cb25-91"><a href="#cb25-91" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb25-92"><a href="#cb25-92" aria-hidden="true" tabindex="-1"></a><span class="co">    Returns:</span></span>
<span id="cb25-93"><a href="#cb25-93" aria-hidden="true" tabindex="-1"></a><span class="co">        Tuple[np.ndarray, np.ndarray]: Maximum likelihood estimates of beta and their standard errors.</span></span>
<span id="cb25-94"><a href="#cb25-94" aria-hidden="true" tabindex="-1"></a><span class="co">    """</span></span>
<span id="cb25-95"><a href="#cb25-95" aria-hidden="true" tabindex="-1"></a>    <span class="co"># Check input data</span></span>
<span id="cb25-96"><a href="#cb25-96" aria-hidden="true" tabindex="-1"></a>    <span class="cf">if</span> <span class="kw">not</span> <span class="bu">isinstance</span>(Y, np.ndarray) <span class="kw">or</span> <span class="kw">not</span> <span class="bu">isinstance</span>(X, np.ndarray):</span>
<span id="cb25-97"><a href="#cb25-97" aria-hidden="true" tabindex="-1"></a>        <span class="cf">raise</span> <span class="pp">TypeError</span>(<span class="st">"Input data must be NumPy arrays."</span>)</span>
<span id="cb25-98"><a href="#cb25-98" aria-hidden="true" tabindex="-1"></a>    <span class="cf">if</span> Y.ndim <span class="op">!=</span> <span class="dv">1</span> <span class="kw">or</span> X.ndim <span class="op">!=</span> <span class="dv">2</span>:</span>
<span id="cb25-99"><a href="#cb25-99" aria-hidden="true" tabindex="-1"></a>        <span class="cf">raise</span> <span class="pp">ValueError</span>(<span class="st">"Input data must have the correct dimensions."</span>)</span>
<span id="cb25-100"><a href="#cb25-100" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb25-101"><a href="#cb25-101" aria-hidden="true" tabindex="-1"></a>    <span class="co"># Initial guess for beta</span></span>
<span id="cb25-102"><a href="#cb25-102" aria-hidden="true" tabindex="-1"></a>    beta0 <span class="op">=</span> np.zeros(X.shape[<span class="dv">1</span>])</span>
<span id="cb25-103"><a href="#cb25-103" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb25-104"><a href="#cb25-104" aria-hidden="true" tabindex="-1"></a>    <span class="co"># Optimize the negative log-likelihood function</span></span>
<span id="cb25-105"><a href="#cb25-105" aria-hidden="true" tabindex="-1"></a>    <span class="cf">try</span>:</span>
<span id="cb25-106"><a href="#cb25-106" aria-hidden="true" tabindex="-1"></a>        result <span class="op">=</span> minimize(negative_poisson_log_likelihood, beta0, args<span class="op">=</span>(Y, X), method<span class="op">=</span><span class="st">'trust-constr'</span>,</span>
<span id="cb25-107"><a href="#cb25-107" aria-hidden="true" tabindex="-1"></a>                          jac<span class="op">=</span>negative_poisson_log_likelihood_grad, hess<span class="op">=</span>negative_poisson_log_likelihood_hess)</span>
<span id="cb25-108"><a href="#cb25-108" aria-hidden="true" tabindex="-1"></a>    <span class="cf">except</span> np.linalg.LinAlgError <span class="im">as</span> e:</span>
<span id="cb25-109"><a href="#cb25-109" aria-hidden="true" tabindex="-1"></a>        <span class="cf">raise</span> <span class="pp">RuntimeError</span>(<span class="st">"Optimization failed due to a linear algebra error."</span>) <span class="im">from</span> e</span>
<span id="cb25-110"><a href="#cb25-110" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb25-111"><a href="#cb25-111" aria-hidden="true" tabindex="-1"></a>    <span class="co"># Get the maximum likelihood estimates of beta</span></span>
<span id="cb25-112"><a href="#cb25-112" aria-hidden="true" tabindex="-1"></a>    beta_mle <span class="op">=</span> result.x</span>
<span id="cb25-113"><a href="#cb25-113" aria-hidden="true" tabindex="-1"></a>    <span class="bu">print</span>(<span class="st">"Maximum Likelihood Estimates of Beta:"</span>)</span>
<span id="cb25-114"><a href="#cb25-114" aria-hidden="true" tabindex="-1"></a>    <span class="bu">print</span>(beta_mle)</span>
<span id="cb25-115"><a href="#cb25-115" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb25-116"><a href="#cb25-116" aria-hidden="true" tabindex="-1"></a>    <span class="co"># Get the Hessian (second-order derivative) at the MLE</span></span>
<span id="cb25-117"><a href="#cb25-117" aria-hidden="true" tabindex="-1"></a>    hessian <span class="op">=</span> negative_poisson_log_likelihood_hess(beta_mle, Y, X)</span>
<span id="cb25-118"><a href="#cb25-118" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb25-119"><a href="#cb25-119" aria-hidden="true" tabindex="-1"></a>    <span class="co"># Standard errors of beta estimates</span></span>
<span id="cb25-120"><a href="#cb25-120" aria-hidden="true" tabindex="-1"></a>    beta_std_errors <span class="op">=</span> np.sqrt(np.diag(np.linalg.inv(hessian)))</span>
<span id="cb25-121"><a href="#cb25-121" aria-hidden="true" tabindex="-1"></a>    <span class="bu">print</span>(<span class="st">"</span><span class="ch">\n</span><span class="st">Standard Errors of Beta Estimates:"</span>)</span>
<span id="cb25-122"><a href="#cb25-122" aria-hidden="true" tabindex="-1"></a>    <span class="bu">print</span>(beta_std_errors)</span>
<span id="cb25-123"><a href="#cb25-123" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb25-124"><a href="#cb25-124" aria-hidden="true" tabindex="-1"></a>    <span class="co"># Print a table of coefficients and standard errors</span></span>
<span id="cb25-125"><a href="#cb25-125" aria-hidden="true" tabindex="-1"></a>    <span class="bu">print</span>(<span class="st">"</span><span class="ch">\n</span><span class="st">Coefficients and Standard Errors:"</span>)</span>
<span id="cb25-126"><a href="#cb25-126" aria-hidden="true" tabindex="-1"></a>    <span class="bu">print</span>(<span class="st">"</span><span class="sc">{:&lt;20}{:&lt;20}</span><span class="st">"</span>.<span class="bu">format</span>(<span class="st">"Coefficient"</span>, <span class="st">"Standard Error"</span>))</span>
<span id="cb25-127"><a href="#cb25-127" aria-hidden="true" tabindex="-1"></a>    <span class="cf">for</span> i <span class="kw">in</span> <span class="bu">range</span>(<span class="bu">len</span>(beta_mle)):</span>
<span id="cb25-128"><a href="#cb25-128" aria-hidden="true" tabindex="-1"></a>        <span class="bu">print</span>(<span class="st">"</span><span class="sc">{:&lt;20}{:&lt;20}</span><span class="st">"</span>.<span class="bu">format</span>(beta_mle[i], beta_std_errors[i]))</span>
<span id="cb25-129"><a href="#cb25-129" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb25-130"><a href="#cb25-130" aria-hidden="true" tabindex="-1"></a>    <span class="cf">return</span> beta_mle, beta_std_errors</span>
<span id="cb25-131"><a href="#cb25-131" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb25-132"><a href="#cb25-132" aria-hidden="true" tabindex="-1"></a><span class="co"># Example usage</span></span>
<span id="cb25-133"><a href="#cb25-133" aria-hidden="true" tabindex="-1"></a><span class="co"># Generate some sample data</span></span>
<span id="cb25-134"><a href="#cb25-134" aria-hidden="true" tabindex="-1"></a>np.random.seed(<span class="dv">42</span>)</span>
<span id="cb25-135"><a href="#cb25-135" aria-hidden="true" tabindex="-1"></a>n_samples <span class="op">=</span> <span class="dv">1000</span></span>
<span id="cb25-136"><a href="#cb25-136" aria-hidden="true" tabindex="-1"></a>n_features <span class="op">=</span> <span class="dv">3</span></span>
<span id="cb25-137"><a href="#cb25-137" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb25-138"><a href="#cb25-138" aria-hidden="true" tabindex="-1"></a>X <span class="op">=</span> np.random.randn(n_samples, n_features)</span>
<span id="cb25-139"><a href="#cb25-139" aria-hidden="true" tabindex="-1"></a>true_beta <span class="op">=</span> np.array([<span class="fl">1.0</span>, <span class="op">-</span><span class="fl">0.5</span>, <span class="fl">0.3</span>])</span>
<span id="cb25-140"><a href="#cb25-140" aria-hidden="true" tabindex="-1"></a>lambda_true <span class="op">=</span> np.exp(X <span class="op">@</span> true_beta)</span>
<span id="cb25-141"><a href="#cb25-141" aria-hidden="true" tabindex="-1"></a>Y <span class="op">=</span> np.random.poisson(lambda_true)</span>
<span id="cb25-142"><a href="#cb25-142" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb25-143"><a href="#cb25-143" aria-hidden="true" tabindex="-1"></a><span class="co"># Fit the Poisson regression model</span></span>
<span id="cb25-144"><a href="#cb25-144" aria-hidden="true" tabindex="-1"></a>beta_mle, beta_std_errors <span class="op">=</span> fit_poisson_regression(Y, X)</span></code><button title="Copy to Clipboard" class="code-copy-button"><i class="bi"></i></button></pre></div>
<div class="cell-output cell-output-stdout">
<pre><code>Maximum Likelihood Estimates of Beta:
[ 0.98288225 -0.49626067  0.3154154 ]

Standard Errors of Beta Estimates:
[0.01614833 0.02230447 0.02179918]

Coefficients and Standard Errors:
Coefficient         Standard Error      
0.9828822489956339  0.016148332022996547
-0.4962606677915634 0.02230447279867141 
0.3154154048523373  0.02179917763934889 </code></pre>
</div>
</div>
<p>Python implementation of Poisson regression using maximum likelihood estimation. Poisson regression is a statistical technique used to model count data, where the response variable (the thing we want to predict) represents the number of occurrences of an event.</p>
<p>The code takes two inputs:</p>
<p>Y: A one-dimensional NumPy array containing the observed count data (the response variable). X: A two-dimensional NumPy array containing the covariate data (the predictor variables). The output of the code is a tuple containing:</p>
<p>beta_mle: A NumPy array with the maximum likelihood estimates of the regression coefficients (betas). beta_std_errors: A NumPy array with the standard errors of the estimated regression coefficients. The code achieves its purpose through the following steps:</p>
<p>It defines helper functions to calculate the log-factorial (log_factorial), the negative log-likelihood (negative_poisson_log_likelihood), its gradient (negative_poisson_log_likelihood_grad), and its Hessian matrix (negative_poisson_log_likelihood_hess). The fit_poisson_regression function takes the input data Y and X and performs the following: a. Checks if the input data is in the correct format (NumPy arrays with the expected dimensions). b. Sets an initial guess for the regression coefficients (beta0). c.&nbsp;Uses the scipy.optimize.minimize function to find the values of beta that minimize the negative log-likelihood function, using the provided gradient and Hessian functions. d.&nbsp;Calculates the standard errors of the estimated coefficients using the Hessian matrix at the maximum likelihood estimates. e. Prints the maximum likelihood estimates of beta and their standard errors. The code includes an example usage section that generates some sample data, fits the Poisson regression model, and stores the results in beta_mle and beta_std_errors. The key logic flows and data transformations happening in the code are:</p>
<p>Calculating the log-factorial for each observed count in Y to use in the negative log-likelihood function. Calculating the predicted counts (lambda_i) for each observation using the linear combination of covariates and coefficients (X @ beta). Calculating the negative log-likelihood, its gradient, and its Hessian matrix using the observed counts (Y), predicted counts (lambda_i), and covariate data (X). Optimizing the negative log-likelihood function using the scipy.optimize.minimize function, which iteratively updates the coefficients (beta) to find the maximum likelihood estimates. Calculating the standard errors of the estimated coefficients using the Hessian matrix at the maximum likelihood estimates. The code aims to provide a way to fit a Poisson regression model to count data and obtain the maximum likelihood estimates of the regression coefficients and their standard errors, which can be used for inference and prediction purposes.</p>
<p>the relationship between the number of patents and various predictor variables, including age, region, and whether the customer is a current customer or not.</p>
<p>The key results are:</p>
<p>Regression Coefficients:</p>
<p>The coefficient for iscustomer is 0.1181, which is positive and statistically significant (p-value = 0.002). This suggests that being a current customer of Blueprinty’s software is associated with a higher expected number of patents. The coefficient for age is 0.1445, which is positive and significant, indicating that older customers tend to have more patents. However, the negative coefficient for age_squared (-0.0029) suggests that the effect of age on the number of patents is non-linear and starts to decrease after a certain age. The coefficients for the different regions are mostly insignificant, except for the Northeast region, which has a positive and significant coefficient (0.1187) compared to the baseline region. Incidence Rate Ratios (IRRs):</p>
<p>The IRR for iscustomer is 1.125373, which means that current customers of Blueprinty’s software are expected to have about 12.5% more patents than non-customers, holding all other variables constant. The IRR for age is 1.155504, indicating that for each additional year of age, the expected number of patents increases by about 15.5%, up to a certain point where the effect starts to decrease due to the negative age_squared term. Model Fit:</p>
<p>The pseudo R-squared value of 0.1152 suggests that the model explains around 11.5% of the variation in the number of patents, which is relatively low but expected for count data models. The deviance and Pearson chi-square statistics indicate some potential overdispersion in the data, which means that the variance of the dependent variable is greater than the mean, violating the assumption of the Poisson distribution. This could be addressed by using a different distribution (e.g., negative binomial) or adjusting the standard errors. Overall, the results suggest that Blueprinty’s software has a positive effect on patent success, as current customers tend to have a higher expected number of patents compared to non-customers, even after accounting for other factors like age and region. However, the effect size is moderate, with a 12.5% increase in the expected number of patents for current customers.</p>
<p>It’s important to note that this analysis assumes a causal relationship between being a Blueprinty customer and patent success, but there could be other confounding factors or selection biases that are not accounted for in the model. Additionally, the relatively low pseudo R-squared value indicates that there are other important factors influencing patent success that are not included in the model.</p>
<div id="0eded457" class="cell" data-execution_count="19">
<div class="sourceCode cell-code" id="cb27"><pre class="sourceCode python code-with-copy"><code class="sourceCode python"><span id="cb27-1"><a href="#cb27-1" aria-hidden="true" tabindex="-1"></a><span class="im">import</span> pandas <span class="im">as</span> pd</span>
<span id="cb27-2"><a href="#cb27-2" aria-hidden="true" tabindex="-1"></a><span class="im">import</span> numpy <span class="im">as</span> np</span>
<span id="cb27-3"><a href="#cb27-3" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb27-4"><a href="#cb27-4" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb27-5"><a href="#cb27-5" aria-hidden="true" tabindex="-1"></a>airbnb <span class="op">=</span> pd.read_csv(<span class="st">'airbnb.csv'</span>)</span>
<span id="cb27-6"><a href="#cb27-6" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb27-7"><a href="#cb27-7" aria-hidden="true" tabindex="-1"></a><span class="co"># Print the first few rows</span></span>
<span id="cb27-8"><a href="#cb27-8" aria-hidden="true" tabindex="-1"></a><span class="bu">print</span>(airbnb.head())</span>
<span id="cb27-9"><a href="#cb27-9" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb27-10"><a href="#cb27-10" aria-hidden="true" tabindex="-1"></a><span class="co"># Check for missing values</span></span>
<span id="cb27-11"><a href="#cb27-11" aria-hidden="true" tabindex="-1"></a><span class="bu">print</span>(airbnb.info())</span>
<span id="cb27-12"><a href="#cb27-12" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb27-13"><a href="#cb27-13" aria-hidden="true" tabindex="-1"></a><span class="co"># Descriptive statistics</span></span>
<span id="cb27-14"><a href="#cb27-14" aria-hidden="true" tabindex="-1"></a><span class="bu">print</span>(airbnb.describe())</span>
<span id="cb27-15"><a href="#cb27-15" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb27-16"><a href="#cb27-16" aria-hidden="true" tabindex="-1"></a><span class="co"># Check for missing values in each column</span></span>
<span id="cb27-17"><a href="#cb27-17" aria-hidden="true" tabindex="-1"></a><span class="bu">print</span>(airbnb.isnull().<span class="bu">sum</span>())</span></code><button title="Copy to Clipboard" class="code-copy-button"><i class="bi"></i></button></pre></div>
<div class="cell-output cell-output-stdout">
<pre><code>   Unnamed: 0    id  days last_scraped  host_since        room_type  \
0           1  2515  3130     4/2/2017    9/6/2008     Private room   
1           2  2595  3127     4/2/2017    9/9/2008  Entire home/apt   
2           3  3647  3050     4/2/2017  11/25/2008     Private room   
3           4  3831  3038     4/2/2017   12/7/2008  Entire home/apt   
4           5  4611  3012     4/2/2017    1/2/2009     Private room   

   bathrooms  bedrooms  price  number_of_reviews  review_scores_cleanliness  \
0        1.0       1.0     59                150                        9.0   
1        1.0       0.0    230                 20                        9.0   
2        1.0       1.0    150                  0                        NaN   
3        1.0       1.0     89                116                        9.0   
4        NaN       1.0     39                 93                        9.0   

   review_scores_location  review_scores_value instant_bookable  
0                     9.0                  9.0                f  
1                    10.0                  9.0                f  
2                     NaN                  NaN                f  
3                     9.0                  9.0                f  
4                     8.0                  9.0                t  
&lt;class 'pandas.core.frame.DataFrame'&gt;
RangeIndex: 40628 entries, 0 to 40627
Data columns (total 14 columns):
 #   Column                     Non-Null Count  Dtype  
---  ------                     --------------  -----  
 0   Unnamed: 0                 40628 non-null  int64  
 1   id                         40628 non-null  int64  
 2   days                       40628 non-null  int64  
 3   last_scraped               40628 non-null  object 
 4   host_since                 40593 non-null  object 
 5   room_type                  40628 non-null  object 
 6   bathrooms                  40468 non-null  float64
 7   bedrooms                   40552 non-null  float64
 8   price                      40628 non-null  int64  
 9   number_of_reviews          40628 non-null  int64  
 10  review_scores_cleanliness  30433 non-null  float64
 11  review_scores_location     30374 non-null  float64
 12  review_scores_value        30372 non-null  float64
 13  instant_bookable           40628 non-null  object 
dtypes: float64(5), int64(5), object(4)
memory usage: 4.3+ MB
None
         Unnamed: 0            id          days     bathrooms      bedrooms  \
count  40628.000000  4.062800e+04  40628.000000  40468.000000  40552.000000   
mean   20314.500000  9.698889e+06   1102.368219      1.124592      1.147046   
std    11728.437705  5.460166e+06   1383.269358      0.385884      0.691746   
min        1.000000  2.515000e+03      1.000000      0.000000      0.000000   
25%    10157.750000  4.889868e+06    542.000000      1.000000      1.000000   
50%    20314.500000  9.862878e+06    996.000000      1.000000      1.000000   
75%    30471.250000  1.466789e+07   1535.000000      1.000000      1.000000   
max    40628.000000  1.800967e+07  42828.000000      8.000000     10.000000   

              price  number_of_reviews  review_scores_cleanliness  \
count  40628.000000       40628.000000               30433.000000   
mean     144.760732          15.904426                   9.198370   
std      210.657597          29.246009                   1.119935   
min       10.000000           0.000000                   2.000000   
25%       70.000000           1.000000                   9.000000   
50%      100.000000           4.000000                  10.000000   
75%      170.000000          17.000000                  10.000000   
max    10000.000000         421.000000                  10.000000   

       review_scores_location  review_scores_value  
count            30374.000000         30372.000000  
mean                 9.413544             9.331522  
std                  0.844949             0.902966  
min                  2.000000             2.000000  
25%                  9.000000             9.000000  
50%                 10.000000            10.000000  
75%                 10.000000            10.000000  
max                 10.000000            10.000000  
Unnamed: 0                       0
id                               0
days                             0
last_scraped                     0
host_since                      35
room_type                        0
bathrooms                      160
bedrooms                        76
price                            0
number_of_reviews                0
review_scores_cleanliness    10195
review_scores_location       10254
review_scores_value          10256
instant_bookable                 0
dtype: int64</code></pre>
</div>
</div>
<div id="006aeb9a" class="cell" data-execution_count="20">
<div class="sourceCode cell-code" id="cb29"><pre class="sourceCode python code-with-copy"><code class="sourceCode python"><span id="cb29-1"><a href="#cb29-1" aria-hidden="true" tabindex="-1"></a><span class="im">import</span> pandas <span class="im">as</span> pd</span>
<span id="cb29-2"><a href="#cb29-2" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb29-3"><a href="#cb29-3" aria-hidden="true" tabindex="-1"></a><span class="co"># Load the Airbnb dataset</span></span>
<span id="cb29-4"><a href="#cb29-4" aria-hidden="true" tabindex="-1"></a>airbnb_data <span class="op">=</span> pd.read_csv(<span class="st">'airbnb.csv'</span>)</span>
<span id="cb29-5"><a href="#cb29-5" aria-hidden="true" tabindex="-1"></a><span class="co"># Handling missing values</span></span>
<span id="cb29-6"><a href="#cb29-6" aria-hidden="true" tabindex="-1"></a>airbnb_data_clean <span class="op">=</span> airbnb_data.copy()</span>
<span id="cb29-7"><a href="#cb29-7" aria-hidden="true" tabindex="-1"></a><span class="co"># Display the first few rows of the dataset</span></span>
<span id="cb29-8"><a href="#cb29-8" aria-hidden="true" tabindex="-1"></a><span class="bu">print</span>(airbnb_data.head())</span>
<span id="cb29-9"><a href="#cb29-9" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb29-10"><a href="#cb29-10" aria-hidden="true" tabindex="-1"></a><span class="co"># Check for missing values</span></span>
<span id="cb29-11"><a href="#cb29-11" aria-hidden="true" tabindex="-1"></a><span class="bu">print</span>(airbnb_data.isnull().<span class="bu">sum</span>())</span>
<span id="cb29-12"><a href="#cb29-12" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb29-13"><a href="#cb29-13" aria-hidden="true" tabindex="-1"></a><span class="co"># Get summary statistics for numerical variables</span></span>
<span id="cb29-14"><a href="#cb29-14" aria-hidden="true" tabindex="-1"></a><span class="bu">print</span>(airbnb_data.describe())</span>
<span id="cb29-15"><a href="#cb29-15" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb29-16"><a href="#cb29-16" aria-hidden="true" tabindex="-1"></a><span class="co"># Check the data types of each variable</span></span>
<span id="cb29-17"><a href="#cb29-17" aria-hidden="true" tabindex="-1"></a><span class="bu">print</span>(airbnb_data.dtypes)</span></code><button title="Copy to Clipboard" class="code-copy-button"><i class="bi"></i></button></pre></div>
<div class="cell-output cell-output-stdout">
<pre><code>   Unnamed: 0    id  days last_scraped  host_since        room_type  \
0           1  2515  3130     4/2/2017    9/6/2008     Private room   
1           2  2595  3127     4/2/2017    9/9/2008  Entire home/apt   
2           3  3647  3050     4/2/2017  11/25/2008     Private room   
3           4  3831  3038     4/2/2017   12/7/2008  Entire home/apt   
4           5  4611  3012     4/2/2017    1/2/2009     Private room   

   bathrooms  bedrooms  price  number_of_reviews  review_scores_cleanliness  \
0        1.0       1.0     59                150                        9.0   
1        1.0       0.0    230                 20                        9.0   
2        1.0       1.0    150                  0                        NaN   
3        1.0       1.0     89                116                        9.0   
4        NaN       1.0     39                 93                        9.0   

   review_scores_location  review_scores_value instant_bookable  
0                     9.0                  9.0                f  
1                    10.0                  9.0                f  
2                     NaN                  NaN                f  
3                     9.0                  9.0                f  
4                     8.0                  9.0                t  
Unnamed: 0                       0
id                               0
days                             0
last_scraped                     0
host_since                      35
room_type                        0
bathrooms                      160
bedrooms                        76
price                            0
number_of_reviews                0
review_scores_cleanliness    10195
review_scores_location       10254
review_scores_value          10256
instant_bookable                 0
dtype: int64
         Unnamed: 0            id          days     bathrooms      bedrooms  \
count  40628.000000  4.062800e+04  40628.000000  40468.000000  40552.000000   
mean   20314.500000  9.698889e+06   1102.368219      1.124592      1.147046   
std    11728.437705  5.460166e+06   1383.269358      0.385884      0.691746   
min        1.000000  2.515000e+03      1.000000      0.000000      0.000000   
25%    10157.750000  4.889868e+06    542.000000      1.000000      1.000000   
50%    20314.500000  9.862878e+06    996.000000      1.000000      1.000000   
75%    30471.250000  1.466789e+07   1535.000000      1.000000      1.000000   
max    40628.000000  1.800967e+07  42828.000000      8.000000     10.000000   

              price  number_of_reviews  review_scores_cleanliness  \
count  40628.000000       40628.000000               30433.000000   
mean     144.760732          15.904426                   9.198370   
std      210.657597          29.246009                   1.119935   
min       10.000000           0.000000                   2.000000   
25%       70.000000           1.000000                   9.000000   
50%      100.000000           4.000000                  10.000000   
75%      170.000000          17.000000                  10.000000   
max    10000.000000         421.000000                  10.000000   

       review_scores_location  review_scores_value  
count            30374.000000         30372.000000  
mean                 9.413544             9.331522  
std                  0.844949             0.902966  
min                  2.000000             2.000000  
25%                  9.000000             9.000000  
50%                 10.000000            10.000000  
75%                 10.000000            10.000000  
max                 10.000000            10.000000  
Unnamed: 0                     int64
id                             int64
days                           int64
last_scraped                  object
host_since                    object
room_type                     object
bathrooms                    float64
bedrooms                     float64
price                          int64
number_of_reviews              int64
review_scores_cleanliness    float64
review_scores_location       float64
review_scores_value          float64
instant_bookable              object
dtype: object</code></pre>
</div>
</div>
<div id="43b48409" class="cell" data-execution_count="21">
<div class="sourceCode cell-code" id="cb31"><pre class="sourceCode python code-with-copy"><code class="sourceCode python"><span id="cb31-1"><a href="#cb31-1" aria-hidden="true" tabindex="-1"></a><span class="co"># Check the data types of each variable</span></span>
<span id="cb31-2"><a href="#cb31-2" aria-hidden="true" tabindex="-1"></a><span class="bu">print</span>(airbnb_data.dtypes)</span></code><button title="Copy to Clipboard" class="code-copy-button"><i class="bi"></i></button></pre></div>
<div class="cell-output cell-output-stdout">
<pre><code>Unnamed: 0                     int64
id                             int64
days                           int64
last_scraped                  object
host_since                    object
room_type                     object
bathrooms                    float64
bedrooms                     float64
price                          int64
number_of_reviews              int64
review_scores_cleanliness    float64
review_scores_location       float64
review_scores_value          float64
instant_bookable              object
dtype: object</code></pre>
</div>
</div>
<div id="a1487d17" class="cell" data-execution_count="22">
<div class="sourceCode cell-code" id="cb33"><pre class="sourceCode python code-with-copy"><code class="sourceCode python"><span id="cb33-1"><a href="#cb33-1" aria-hidden="true" tabindex="-1"></a><span class="co"># Convert 'last_scraped' and 'host_since' to datetime</span></span>
<span id="cb33-2"><a href="#cb33-2" aria-hidden="true" tabindex="-1"></a>airbnb_data_clean.loc[:, <span class="st">'last_scraped'</span>] <span class="op">=</span> pd.to_datetime(airbnb_data_clean[<span class="st">'last_scraped'</span>])</span>
<span id="cb33-3"><a href="#cb33-3" aria-hidden="true" tabindex="-1"></a>airbnb_data_clean.loc[:, <span class="st">'host_since'</span>] <span class="op">=</span> pd.to_datetime(airbnb_data_clean[<span class="st">'host_since'</span>])</span>
<span id="cb33-4"><a href="#cb33-4" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb33-5"><a href="#cb33-5" aria-hidden="true" tabindex="-1"></a><span class="co"># Convert 'room_type' and 'instant_bookable' to categorical</span></span>
<span id="cb33-6"><a href="#cb33-6" aria-hidden="true" tabindex="-1"></a>airbnb_data_clean.loc[:, <span class="st">'room_type'</span>] <span class="op">=</span> airbnb_data_clean[<span class="st">'room_type'</span>].astype(<span class="st">'category'</span>)</span>
<span id="cb33-7"><a href="#cb33-7" aria-hidden="true" tabindex="-1"></a>airbnb_data_clean.loc[:, <span class="st">'instant_bookable'</span>] <span class="op">=</span> airbnb_data_clean[<span class="st">'instant_bookable'</span>].astype(<span class="st">'category'</span>)</span></code><button title="Copy to Clipboard" class="code-copy-button"><i class="bi"></i></button></pre></div>
</div>
<div id="86e9a247" class="cell" data-execution_count="23">
<div class="sourceCode cell-code" id="cb34"><pre class="sourceCode python code-with-copy"><code class="sourceCode python"><span id="cb34-1"><a href="#cb34-1" aria-hidden="true" tabindex="-1"></a><span class="im">import</span> pandas <span class="im">as</span> pd</span>
<span id="cb34-2"><a href="#cb34-2" aria-hidden="true" tabindex="-1"></a><span class="im">import</span> numpy <span class="im">as</span> np</span>
<span id="cb34-3"><a href="#cb34-3" aria-hidden="true" tabindex="-1"></a><span class="im">import</span> matplotlib.pyplot <span class="im">as</span> plt</span>
<span id="cb34-4"><a href="#cb34-4" aria-hidden="true" tabindex="-1"></a><span class="im">import</span> seaborn <span class="im">as</span> sns</span>
<span id="cb34-5"><a href="#cb34-5" aria-hidden="true" tabindex="-1"></a><span class="im">import</span> statsmodels.api <span class="im">as</span> sm</span>
<span id="cb34-6"><a href="#cb34-6" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb34-7"><a href="#cb34-7" aria-hidden="true" tabindex="-1"></a><span class="co"># Load Airbnb data</span></span>
<span id="cb34-8"><a href="#cb34-8" aria-hidden="true" tabindex="-1"></a>airbnb_data <span class="op">=</span> pd.read_csv(<span class="st">'airbnb.csv'</span>)</span>
<span id="cb34-9"><a href="#cb34-9" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb34-10"><a href="#cb34-10" aria-hidden="true" tabindex="-1"></a><span class="co"># Handling missing values</span></span>
<span id="cb34-11"><a href="#cb34-11" aria-hidden="true" tabindex="-1"></a>airbnb_data_clean <span class="op">=</span> airbnb_data.copy()</span>
<span id="cb34-12"><a href="#cb34-12" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb34-13"><a href="#cb34-13" aria-hidden="true" tabindex="-1"></a><span class="co"># Convert date columns to datetime</span></span>
<span id="cb34-14"><a href="#cb34-14" aria-hidden="true" tabindex="-1"></a>airbnb_data_clean[<span class="st">'last_scraped'</span>] <span class="op">=</span> pd.to_datetime(airbnb_data_clean[<span class="st">'last_scraped'</span>])</span>
<span id="cb34-15"><a href="#cb34-15" aria-hidden="true" tabindex="-1"></a>airbnb_data_clean[<span class="st">'host_since'</span>] <span class="op">=</span> pd.to_datetime(airbnb_data_clean[<span class="st">'host_since'</span>])</span>
<span id="cb34-16"><a href="#cb34-16" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb34-17"><a href="#cb34-17" aria-hidden="true" tabindex="-1"></a><span class="co"># Impute missing values for numeric variables</span></span>
<span id="cb34-18"><a href="#cb34-18" aria-hidden="true" tabindex="-1"></a>numeric_cols <span class="op">=</span> [<span class="st">'bathrooms'</span>, <span class="st">'bedrooms'</span>, <span class="st">'review_scores_cleanliness'</span>, </span>
<span id="cb34-19"><a href="#cb34-19" aria-hidden="true" tabindex="-1"></a>                <span class="st">'review_scores_location'</span>, <span class="st">'review_scores_value'</span>]</span>
<span id="cb34-20"><a href="#cb34-20" aria-hidden="true" tabindex="-1"></a>airbnb_data_clean[numeric_cols] <span class="op">=</span> airbnb_data_clean[numeric_cols].fillna(airbnb_data_clean[numeric_cols].median())</span>
<span id="cb34-21"><a href="#cb34-21" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb34-22"><a href="#cb34-22" aria-hidden="true" tabindex="-1"></a><span class="co"># Replace missing values for categorical variables</span></span>
<span id="cb34-23"><a href="#cb34-23" aria-hidden="true" tabindex="-1"></a>airbnb_data_clean[<span class="st">'room_type'</span>] <span class="op">=</span> airbnb_data_clean[<span class="st">'room_type'</span>].fillna(airbnb_data_clean[<span class="st">'room_type'</span>].mode().iloc[<span class="dv">0</span>])</span>
<span id="cb34-24"><a href="#cb34-24" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb34-25"><a href="#cb34-25" aria-hidden="true" tabindex="-1"></a><span class="co"># Drop rows with missing values in crucial columns</span></span>
<span id="cb34-26"><a href="#cb34-26" aria-hidden="true" tabindex="-1"></a>airbnb_data_clean <span class="op">=</span> airbnb_data_clean.dropna(subset<span class="op">=</span>[<span class="st">'host_since'</span>])</span>
<span id="cb34-27"><a href="#cb34-27" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb34-28"><a href="#cb34-28" aria-hidden="true" tabindex="-1"></a><span class="co"># Convert non-numeric columns to numeric</span></span>
<span id="cb34-29"><a href="#cb34-29" aria-hidden="true" tabindex="-1"></a>airbnb_data_clean[<span class="st">'room_type'</span>] <span class="op">=</span> airbnb_data_clean[<span class="st">'room_type'</span>].astype(<span class="st">'category'</span>).cat.codes</span>
<span id="cb34-30"><a href="#cb34-30" aria-hidden="true" tabindex="-1"></a>airbnb_data_clean[<span class="st">'instant_bookable'</span>] <span class="op">=</span> airbnb_data_clean[<span class="st">'instant_bookable'</span>].astype(<span class="st">'category'</span>).cat.codes</span>
<span id="cb34-31"><a href="#cb34-31" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb34-32"><a href="#cb34-32" aria-hidden="true" tabindex="-1"></a><span class="co"># Exploratory Data Analysis (EDA)</span></span>
<span id="cb34-33"><a href="#cb34-33" aria-hidden="true" tabindex="-1"></a><span class="co"># Summary statistics</span></span>
<span id="cb34-34"><a href="#cb34-34" aria-hidden="true" tabindex="-1"></a>summary_stats <span class="op">=</span> airbnb_data_clean.describe(include<span class="op">=</span><span class="st">'all'</span>)</span>
<span id="cb34-35"><a href="#cb34-35" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb34-36"><a href="#cb34-36" aria-hidden="true" tabindex="-1"></a><span class="co"># Visualizations </span></span>
<span id="cb34-37"><a href="#cb34-37" aria-hidden="true" tabindex="-1"></a><span class="co"># Histograms of numeric variables</span></span>
<span id="cb34-38"><a href="#cb34-38" aria-hidden="true" tabindex="-1"></a>numeric_cols <span class="op">=</span> [<span class="st">'bathrooms'</span>, <span class="st">'bedrooms'</span>, <span class="st">'price'</span>, <span class="st">'number_of_reviews'</span>]</span>
<span id="cb34-39"><a href="#cb34-39" aria-hidden="true" tabindex="-1"></a>airbnb_data_clean[numeric_cols].hist(bins<span class="op">=</span><span class="dv">20</span>, figsize<span class="op">=</span>(<span class="dv">12</span>, <span class="dv">8</span>))</span>
<span id="cb34-40"><a href="#cb34-40" aria-hidden="true" tabindex="-1"></a>plt.show()</span>
<span id="cb34-41"><a href="#cb34-41" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb34-42"><a href="#cb34-42" aria-hidden="true" tabindex="-1"></a><span class="co"># Correlation matrix</span></span>
<span id="cb34-43"><a href="#cb34-43" aria-hidden="true" tabindex="-1"></a>corr_matrix <span class="op">=</span> airbnb_data_clean[numeric_cols <span class="op">+</span> [<span class="st">'review_scores_cleanliness'</span>, <span class="st">'review_scores_location'</span>, <span class="st">'review_scores_value'</span>]].corr()</span>
<span id="cb34-44"><a href="#cb34-44" aria-hidden="true" tabindex="-1"></a>sns.heatmap(corr_matrix, annot<span class="op">=</span><span class="va">True</span>, cmap<span class="op">=</span><span class="st">'coolwarm'</span>, fmt<span class="op">=</span><span class="st">".2f"</span>)</span>
<span id="cb34-45"><a href="#cb34-45" aria-hidden="true" tabindex="-1"></a>plt.title(<span class="st">'Correlation Matrix'</span>)</span>
<span id="cb34-46"><a href="#cb34-46" aria-hidden="true" tabindex="-1"></a>plt.show()</span></code><button title="Copy to Clipboard" class="code-copy-button"><i class="bi"></i></button></pre></div>
<div class="cell-output cell-output-display">
<div>
<figure class="figure">
<p><img src="index_files/figure-html/cell-24-output-1.png" width="964" height="653" class="figure-img"></p>
</figure>
</div>
</div>
<div class="cell-output cell-output-display">
<div>
<figure class="figure">
<p><img src="index_files/figure-html/cell-24-output-2.png" width="695" height="593" class="figure-img"></p>
</figure>
</div>
</div>
</div>
<div id="8b710419" class="cell" data-execution_count="24">
<div class="sourceCode cell-code" id="cb35"><pre class="sourceCode python code-with-copy"><code class="sourceCode python"><span id="cb35-1"><a href="#cb35-1" aria-hidden="true" tabindex="-1"></a><span class="co"># Define the dependent and independent variables</span></span>
<span id="cb35-2"><a href="#cb35-2" aria-hidden="true" tabindex="-1"></a>dependent_var <span class="op">=</span> airbnb_data_clean[<span class="st">'number_of_reviews'</span>]</span>
<span id="cb35-3"><a href="#cb35-3" aria-hidden="true" tabindex="-1"></a>independent_vars <span class="op">=</span> airbnb_data_clean[[<span class="st">'bathrooms'</span>, <span class="st">'bedrooms'</span>, <span class="st">'price'</span>, <span class="st">'review_scores_cleanliness'</span>,</span>
<span id="cb35-4"><a href="#cb35-4" aria-hidden="true" tabindex="-1"></a>                                      <span class="st">'review_scores_location'</span>, <span class="st">'review_scores_value'</span>, <span class="st">'room_type'</span>, <span class="st">'instant_bookable'</span>]]</span>
<span id="cb35-5"><a href="#cb35-5" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb35-6"><a href="#cb35-6" aria-hidden="true" tabindex="-1"></a><span class="co"># Add intercept term  </span></span>
<span id="cb35-7"><a href="#cb35-7" aria-hidden="true" tabindex="-1"></a>independent_vars <span class="op">=</span> sm.add_constant(independent_vars)</span>
<span id="cb35-8"><a href="#cb35-8" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb35-9"><a href="#cb35-9" aria-hidden="true" tabindex="-1"></a><span class="co"># Split data into training and testing sets</span></span>
<span id="cb35-10"><a href="#cb35-10" aria-hidden="true" tabindex="-1"></a><span class="co"># For simplicity, you can use the entire dataset for demonstration</span></span>
<span id="cb35-11"><a href="#cb35-11" aria-hidden="true" tabindex="-1"></a>train_data <span class="op">=</span> independent_vars  </span>
<span id="cb35-12"><a href="#cb35-12" aria-hidden="true" tabindex="-1"></a>test_data <span class="op">=</span> dependent_var</span>
<span id="cb35-13"><a href="#cb35-13" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb35-14"><a href="#cb35-14" aria-hidden="true" tabindex="-1"></a><span class="co"># Fit the Poisson regression model</span></span>
<span id="cb35-15"><a href="#cb35-15" aria-hidden="true" tabindex="-1"></a>poisson_model <span class="op">=</span> sm.GLM(dependent_var, independent_vars, family<span class="op">=</span>sm.families.Poisson()).fit()</span>
<span id="cb35-16"><a href="#cb35-16" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb35-17"><a href="#cb35-17" aria-hidden="true" tabindex="-1"></a><span class="co"># Print the summary of the model</span></span>
<span id="cb35-18"><a href="#cb35-18" aria-hidden="true" tabindex="-1"></a><span class="bu">print</span>(poisson_model.summary())</span></code><button title="Copy to Clipboard" class="code-copy-button"><i class="bi"></i></button></pre></div>
<div class="cell-output cell-output-stdout">
<pre><code>                 Generalized Linear Model Regression Results                  
==============================================================================
Dep. Variable:      number_of_reviews   No. Observations:                40593
Model:                            GLM   Df Residuals:                    40584
Model Family:                 Poisson   Df Model:                            8
Link Function:                    Log   Scale:                          1.0000
Method:                          IRLS   Log-Likelihood:            -6.9861e+05
Date:                Thu, 30 May 2024   Deviance:                   1.2733e+06
Time:                        13:12:29   Pearson chi2:                 2.05e+06
No. Iterations:                     7   Pseudo R-squ. (CS):             0.8046
Covariance Type:            nonrobust                                         
=============================================================================================
                                coef    std err          z      P&gt;|z|      [0.025      0.975]
---------------------------------------------------------------------------------------------
const                         5.6050      0.013    436.916      0.000       5.580       5.630
bathrooms                    -0.1215      0.004    -31.927      0.000      -0.129      -0.114
bedrooms                      0.0710      0.002     35.747      0.000       0.067       0.075
price                        -0.0003   1.09e-05    -23.524      0.000      -0.000      -0.000
review_scores_cleanliness     0.0377      0.001     26.009      0.000       0.035       0.041
review_scores_location       -0.1804      0.002   -117.128      0.000      -0.183      -0.177
review_scores_value          -0.1467      0.002    -82.747      0.000      -0.150      -0.143
room_type                    -0.1669      0.003    -66.441      0.000      -0.172      -0.162
instant_bookable              0.3335      0.003    116.055      0.000       0.328       0.339
=============================================================================================</code></pre>
</div>
</div>
<p>we can interpret the coefficients as follows:</p>
<p>The intercept coefficient (const) of 5.6050 represents the expected log count of reviews when all other variables are zero.</p>
<p>The coefficient for bathrooms is -0.1215, indicating that for every one-unit increase in the number of bathrooms, the expected log count of reviews decreases by 0.1215, holding all other variables constant.</p>
<p>The coefficient for bedrooms is 0.0710, suggesting that for every one-unit increase in the number of bedrooms, the expected log count of reviews increases by 0.0710, holding all other variables constant.</p>
<p>The coefficient for price is -0.0003, which means that for every $1 increase in the price, the expected log count of reviews decreases by 0.0003, holding all other variables constant.</p>
<p>The coefficient for review_scores_cleanliness is 0.0377, indicating that for every one-unit increase in the cleanliness review score, the expected log count of reviews increases by 0.0377, holding all other variables constant.</p>
<p>The coefficient for review_scores_location is -0.1804, suggesting that for every one-unit increase in the location review score, the expected log count of reviews decreases by 0.1804, holding all other variables constant.</p>
<p>The coefficient for review_scores_value is -0.1467, which means that for every one-unit increase in the value review score, the expected log count of reviews decreases by 0.1467, holding all other variables constant.</p>
<p>The coefficient for room_type is -0.1669, indicating that for every one-unit increase in the room type category (e.g., moving from a reference category to the next category), the expected log count of reviews decreases by 0.1669, holding all other variables constant.</p>
<p>The coefficient for instant_bookable is 0.3335, suggesting that for listings that are instantly bookable (compared to those that are not), the expected log count of reviews increases by 0.3335, holding all other variables constant.</p>
<p>It’s important to note that the interpretation of coefficients in Poisson regression models is in terms of the log count of the dependent variable (number_of_reviews), rather than the actual count itself. Additionally, you should consider the statistical significance of the coefficients (based on p-values or confidence intervals) when interpreting the results.</p>
<p>The model summary also provides other useful information, such as the number of observations, degrees of freedom, log-likelihood, deviance, and pseudo R-squared values, which can be used to assess the overall model fit and performance.</p>
<p>The Airbnb dataset consists of over 40,000 listings from New York City, scraped in March 2017. The analysis aimed to understand the factors influencing the number of reviews received by Airbnb listings, which can be considered a proxy for the number of bookings.</p>
<p>After data cleaning and preprocessing, including handling missing values and converting data types, a Poisson regression model was fitted to model the number of reviews as a function of various independent variables.</p>
<p>The Poisson regression model revealed several significant factors influencing the number of reviews:</p>
<p>Bathrooms: An increase in the number of bathrooms was associated with a decrease in the expected log count of reviews, suggesting that listings with fewer bathrooms tend to receive more reviews.</p>
<p>Bedrooms: An increase in the number of bedrooms was associated with an increase in the expected log count of reviews, indicating that listings with more bedrooms tend to receive more reviews.</p>
<p>Price: Higher listing prices were associated with a decrease in the expected log count of reviews, suggesting that more affordable listings tend to receive more reviews.</p>
<p>Review Scores: Higher cleanliness review scores were associated with an increase in the expected log count of reviews, while higher location and value review scores were associated with a decrease in the expected log count of reviews.</p>
<p>Room Type: Moving from one room type category to the next (e.g., from a reference category to the next category) was associated with a decrease in the expected log count of reviews.</p>
<p>Instant Bookable: Listings that were instantly bookable were associated with an increase in the expected log count of reviews compared to those that were not instantly bookable.</p>
<p>The analysis also included exploratory data analysis, such as summary statistics, histograms of numeric variables, and a correlation matrix, which provided insights into the data distribution and relationships between variables.</p>
<p>Overall, the Airbnb data analysis revealed several factors that influence the number of reviews received by listings, which can be used by hosts and the platform to optimize their offerings and improve the overall user experience.</p>
<!-- ---
title: "Homework 2"
editor: visual


---
 -->



</main> <!-- /main -->
<script id="quarto-html-after-body" type="application/javascript">
window.document.addEventListener("DOMContentLoaded", function (event) {
  const toggleBodyColorMode = (bsSheetEl) => {
    const mode = bsSheetEl.getAttribute("data-mode");
    const bodyEl = window.document.querySelector("body");
    if (mode === "dark") {
      bodyEl.classList.add("quarto-dark");
      bodyEl.classList.remove("quarto-light");
    } else {
      bodyEl.classList.add("quarto-light");
      bodyEl.classList.remove("quarto-dark");
    }
  }
  const toggleBodyColorPrimary = () => {
    const bsSheetEl = window.document.querySelector("link#quarto-bootstrap");
    if (bsSheetEl) {
      toggleBodyColorMode(bsSheetEl);
    }
  }
  toggleBodyColorPrimary();  
  const icon = "";
  const anchorJS = new window.AnchorJS();
  anchorJS.options = {
    placement: 'right',
    icon: icon
  };
  anchorJS.add('.anchored');
  const isCodeAnnotation = (el) => {
    for (const clz of el.classList) {
      if (clz.startsWith('code-annotation-')) {                     
        return true;
      }
    }
    return false;
  }
  const clipboard = new window.ClipboardJS('.code-copy-button', {
    text: function(trigger) {
      const codeEl = trigger.previousElementSibling.cloneNode(true);
      for (const childEl of codeEl.children) {
        if (isCodeAnnotation(childEl)) {
          childEl.remove();
        }
      }
      return codeEl.innerText;
    }
  });
  clipboard.on('success', function(e) {
    // button target
    const button = e.trigger;
    // don't keep focus
    button.blur();
    // flash "checked"
    button.classList.add('code-copy-button-checked');
    var currentTitle = button.getAttribute("title");
    button.setAttribute("title", "Copied!");
    let tooltip;
    if (window.bootstrap) {
      button.setAttribute("data-bs-toggle", "tooltip");
      button.setAttribute("data-bs-placement", "left");
      button.setAttribute("data-bs-title", "Copied!");
      tooltip = new bootstrap.Tooltip(button, 
        { trigger: "manual", 
          customClass: "code-copy-button-tooltip",
          offset: [0, -8]});
      tooltip.show();    
    }
    setTimeout(function() {
      if (tooltip) {
        tooltip.hide();
        button.removeAttribute("data-bs-title");
        button.removeAttribute("data-bs-toggle");
        button.removeAttribute("data-bs-placement");
      }
      button.setAttribute("title", currentTitle);
      button.classList.remove('code-copy-button-checked');
    }, 1000);
    // clear code selection
    e.clearSelection();
  });
  function tippyHover(el, contentFn, onTriggerFn, onUntriggerFn) {
    const config = {
      allowHTML: true,
      maxWidth: 500,
      delay: 100,
      arrow: false,
      appendTo: function(el) {
          return el.parentElement;
      },
      interactive: true,
      interactiveBorder: 10,
      theme: 'quarto',
      placement: 'bottom-start',
    };
    if (contentFn) {
      config.content = contentFn;
    }
    if (onTriggerFn) {
      config.onTrigger = onTriggerFn;
    }
    if (onUntriggerFn) {
      config.onUntrigger = onUntriggerFn;
    }
    window.tippy(el, config); 
  }
  const noterefs = window.document.querySelectorAll('a[role="doc-noteref"]');
  for (var i=0; i<noterefs.length; i++) {
    const ref = noterefs[i];
    tippyHover(ref, function() {
      // use id or data attribute instead here
      let href = ref.getAttribute('data-footnote-href') || ref.getAttribute('href');
      try { href = new URL(href).hash; } catch {}
      const id = href.replace(/^#\/?/, "");
      const note = window.document.getElementById(id);
      return note.innerHTML;
    });
  }
  const xrefs = window.document.querySelectorAll('a.quarto-xref');
  const processXRef = (id, note) => {
    // Strip column container classes
    const stripColumnClz = (el) => {
      el.classList.remove("page-full", "page-columns");
      if (el.children) {
        for (const child of el.children) {
          stripColumnClz(child);
        }
      }
    }
    stripColumnClz(note)
    const typesetMath = (el) => {
      if (window.MathJax) {
        // MathJax Typeset
        window.MathJax.typeset([el]);
      } else if (window.katex) {
        // KaTeX Render
        var mathElements = el.getElementsByClassName("math");
        var macros = [];
        for (var i = 0; i < mathElements.length; i++) {
          var texText = mathElements[i].firstChild;
          if (mathElements[i].tagName == "SPAN") {
            window.katex.render(texText.data, mathElements[i], {
              displayMode: mathElements[i].classList.contains('display'),
              throwOnError: false,
              macros: macros,
              fleqn: false
            });
          }
        }
      }
    }
    if (id === null || id.startsWith('sec-')) {
      // Special case sections, only their first couple elements
      const container = document.createElement("div");
      if (note.children && note.children.length > 2) {
        container.appendChild(note.children[0].cloneNode(true));
        for (let i = 1; i < note.children.length; i++) {
          const child = note.children[i];
          if (child.tagName === "P" && child.innerText === "") {
            continue;
          } else {
            container.appendChild(child.cloneNode(true));
            break;
          }
        }
        typesetMath(container);
        return container.innerHTML
      } else {
        typesetMath(note);
        return note.innerHTML;
      }
    } else {
      // Remove any anchor links if they are present
      const anchorLink = note.querySelector('a.anchorjs-link');
      if (anchorLink) {
        anchorLink.remove();
      }
      typesetMath(note);
      return note.innerHTML;
    }
  }
  for (var i=0; i<xrefs.length; i++) {
    const xref = xrefs[i];
    tippyHover(xref, undefined, function(instance) {
      instance.disable();
      let url = xref.getAttribute('href');
      let hash = undefined; 
      if (url.startsWith('#')) {
        hash = url;
      } else {
        try { hash = new URL(url).hash; } catch {}
      }
      if (hash) {
        const id = hash.replace(/^#\/?/, "");
        const note = window.document.getElementById(id);
        if (note !== null) {
          try {
            const html = processXRef(id, note.cloneNode(true));
            instance.setContent(html);
          } finally {
            instance.enable();
            instance.show();
          }
        } else {
          // See if we can fetch this
          fetch(url.split('#')[0])
          .then(res => res.text())
          .then(html => {
            const parser = new DOMParser();
            const htmlDoc = parser.parseFromString(html, "text/html");
            const note = htmlDoc.getElementById(id);
            if (note !== null) {
              const html = processXRef(id, note);
              instance.setContent(html);
            } 
          }).finally(() => {
            instance.enable();
            instance.show();
          });
        }
      } else {
        // See if we can fetch a full url (with no hash to target)
        // This is a special case and we should probably do some content thinning / targeting
        fetch(url)
        .then(res => res.text())
        .then(html => {
          const parser = new DOMParser();
          const htmlDoc = parser.parseFromString(html, "text/html");
          const note = htmlDoc.querySelector('main.content');
          if (note !== null) {
            // This should only happen for chapter cross references
            // (since there is no id in the URL)
            // remove the first header
            if (note.children.length > 0 && note.children[0].tagName === "HEADER") {
              note.children[0].remove();
            }
            const html = processXRef(null, note);
            instance.setContent(html);
          } 
        }).finally(() => {
          instance.enable();
          instance.show();
        });
      }
    }, function(instance) {
    });
  }
      let selectedAnnoteEl;
      const selectorForAnnotation = ( cell, annotation) => {
        let cellAttr = 'data-code-cell="' + cell + '"';
        let lineAttr = 'data-code-annotation="' +  annotation + '"';
        const selector = 'span[' + cellAttr + '][' + lineAttr + ']';
        return selector;
      }
      const selectCodeLines = (annoteEl) => {
        const doc = window.document;
        const targetCell = annoteEl.getAttribute("data-target-cell");
        const targetAnnotation = annoteEl.getAttribute("data-target-annotation");
        const annoteSpan = window.document.querySelector(selectorForAnnotation(targetCell, targetAnnotation));
        const lines = annoteSpan.getAttribute("data-code-lines").split(",");
        const lineIds = lines.map((line) => {
          return targetCell + "-" + line;
        })
        let top = null;
        let height = null;
        let parent = null;
        if (lineIds.length > 0) {
            //compute the position of the single el (top and bottom and make a div)
            const el = window.document.getElementById(lineIds[0]);
            top = el.offsetTop;
            height = el.offsetHeight;
            parent = el.parentElement.parentElement;
          if (lineIds.length > 1) {
            const lastEl = window.document.getElementById(lineIds[lineIds.length - 1]);
            const bottom = lastEl.offsetTop + lastEl.offsetHeight;
            height = bottom - top;
          }
          if (top !== null && height !== null && parent !== null) {
            // cook up a div (if necessary) and position it 
            let div = window.document.getElementById("code-annotation-line-highlight");
            if (div === null) {
              div = window.document.createElement("div");
              div.setAttribute("id", "code-annotation-line-highlight");
              div.style.position = 'absolute';
              parent.appendChild(div);
            }
            div.style.top = top - 2 + "px";
            div.style.height = height + 4 + "px";
            div.style.left = 0;
            let gutterDiv = window.document.getElementById("code-annotation-line-highlight-gutter");
            if (gutterDiv === null) {
              gutterDiv = window.document.createElement("div");
              gutterDiv.setAttribute("id", "code-annotation-line-highlight-gutter");
              gutterDiv.style.position = 'absolute';
              const codeCell = window.document.getElementById(targetCell);
              const gutter = codeCell.querySelector('.code-annotation-gutter');
              gutter.appendChild(gutterDiv);
            }
            gutterDiv.style.top = top - 2 + "px";
            gutterDiv.style.height = height + 4 + "px";
          }
          selectedAnnoteEl = annoteEl;
        }
      };
      const unselectCodeLines = () => {
        const elementsIds = ["code-annotation-line-highlight", "code-annotation-line-highlight-gutter"];
        elementsIds.forEach((elId) => {
          const div = window.document.getElementById(elId);
          if (div) {
            div.remove();
          }
        });
        selectedAnnoteEl = undefined;
      };
        // Handle positioning of the toggle
    window.addEventListener(
      "resize",
      throttle(() => {
        elRect = undefined;
        if (selectedAnnoteEl) {
          selectCodeLines(selectedAnnoteEl);
        }
      }, 10)
    );
    function throttle(fn, ms) {
    let throttle = false;
    let timer;
      return (...args) => {
        if(!throttle) { // first call gets through
            fn.apply(this, args);
            throttle = true;
        } else { // all the others get throttled
            if(timer) clearTimeout(timer); // cancel #2
            timer = setTimeout(() => {
              fn.apply(this, args);
              timer = throttle = false;
            }, ms);
        }
      };
    }
      // Attach click handler to the DT
      const annoteDls = window.document.querySelectorAll('dt[data-target-cell]');
      for (const annoteDlNode of annoteDls) {
        annoteDlNode.addEventListener('click', (event) => {
          const clickedEl = event.target;
          if (clickedEl !== selectedAnnoteEl) {
            unselectCodeLines();
            const activeEl = window.document.querySelector('dt[data-target-cell].code-annotation-active');
            if (activeEl) {
              activeEl.classList.remove('code-annotation-active');
            }
            selectCodeLines(clickedEl);
            clickedEl.classList.add('code-annotation-active');
          } else {
            // Unselect the line
            unselectCodeLines();
            clickedEl.classList.remove('code-annotation-active');
          }
        });
      }
  const findCites = (el) => {
    const parentEl = el.parentElement;
    if (parentEl) {
      const cites = parentEl.dataset.cites;
      if (cites) {
        return {
          el,
          cites: cites.split(' ')
        };
      } else {
        return findCites(el.parentElement)
      }
    } else {
      return undefined;
    }
  };
  var bibliorefs = window.document.querySelectorAll('a[role="doc-biblioref"]');
  for (var i=0; i<bibliorefs.length; i++) {
    const ref = bibliorefs[i];
    const citeInfo = findCites(ref);
    if (citeInfo) {
      tippyHover(citeInfo.el, function() {
        var popup = window.document.createElement('div');
        citeInfo.cites.forEach(function(cite) {
          var citeDiv = window.document.createElement('div');
          citeDiv.classList.add('hanging-indent');
          citeDiv.classList.add('csl-entry');
          var biblioDiv = window.document.getElementById('ref-' + cite);
          if (biblioDiv) {
            citeDiv.innerHTML = biblioDiv.innerHTML;
          }
          popup.appendChild(citeDiv);
        });
        return popup.innerHTML;
      });
    }
  }
});
</script>
</div> <!-- /content -->




</body></html>